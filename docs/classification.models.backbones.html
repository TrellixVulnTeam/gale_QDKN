---

title: Backbones 


keywords: fastai
sidebar: home_sidebar

summary: "Backbones/feature extractors for use in Image Classification Tasks"
description: "Backbones/feature extractors for use in Image Classification Tasks"
nb_path: "nbs/04_classification.models.backbones.ipynb"
---
<!--

#################################################
### THIS FILE WAS AUTOGENERATED! DO NOT EDIT! ###
#################################################
# file to edit: nbs/04_classification.models.backbones.ipynb
# command to build the docs after a change: nbdev_build_docs

-->

<div class="container" id="notebook-container">
        
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">




<div id="93d3a630-58e9-46b2-b2bc-7275b9b0bd8e"></div>
<div class="output_subarea output_javascript ">
<script type="text/javascript">
var element = $('#93d3a630-58e9-46b2-b2bc-7275b9b0bd8e');

            setTimeout(function() {
                var nbb_cell_id = 5;
                var nbb_unformatted_code = "# export\n_all_ = [\"IMAGE_CLASSIFIER_BACKBONES\"]";
                var nbb_formatted_code = "# export\n_all_ = [\"IMAGE_CLASSIFIER_BACKBONES\"]";
                var nbb_cells = Jupyter.notebook.get_cells();
                for (var i = 0; i < nbb_cells.length; ++i) {
                    if (nbb_cells[i].input_prompt_number == nbb_cell_id) {
                        if (nbb_cells[i].get_text() == nbb_unformatted_code) {
                             nbb_cells[i].set_text(nbb_formatted_code);
                        }
                        break;
                    }
                }
            }, 500);
            
</script>
</div>

</div>

</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2 id="Utils-function">Utils function<a class="anchor-link" href="#Utils-function"> </a></h2>
</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="has_pool_type" class="doc_header"><code>has_pool_type</code><a href="https://github.com/benihime91/gale/tree/master/gale/classification/model/backbones.py#L41" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>has_pool_type</code>(<strong><code>m</code></strong>:<code>Module</code>)</p>
</blockquote>
<p>Return <code>True</code> if <code>m</code> is a pooling layer or has one in its children
From: <a href="https://github.com/fastai/fastai/blob/master/fastai/vision/learner.py#L76">https://github.com/fastai/fastai/blob/master/fastai/vision/learner.py#L76</a></p>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">




<div id="30cb953e-0174-4404-9a76-52b9405917f7"></div>
<div class="output_subarea output_javascript ">
<script type="text/javascript">
var element = $('#30cb953e-0174-4404-9a76-52b9405917f7');

            setTimeout(function() {
                var nbb_cell_id = 7;
                var nbb_unformatted_code = "# export\ndef _is_pool_type(l: nn.Module) -> bool:\n    \"\"\"\n    True if `l` is a pooling layer.\n    From: https://github.com/fastai/fastai/blob/master/fastai/vision/learner.py#L76\n    \"\"\"\n    return re.search(r\"Pool[123]d$\", l.__class__.__name__)\n\n\ndef has_pool_type(m: nn.Module) -> bool:\n    \"\"\"\n    Return `True` if `m` is a pooling layer or has one in its children\n    From: https://github.com/fastai/fastai/blob/master/fastai/vision/learner.py#L76\n    \"\"\"\n    if _is_pool_type(m):\n        return True\n    for l in m.children():\n        if has_pool_type(l):\n            return True\n    return False";
                var nbb_formatted_code = "# export\ndef _is_pool_type(l: nn.Module) -> bool:\n    \"\"\"\n    True if `l` is a pooling layer.\n    From: https://github.com/fastai/fastai/blob/master/fastai/vision/learner.py#L76\n    \"\"\"\n    return re.search(r\"Pool[123]d$\", l.__class__.__name__)\n\n\ndef has_pool_type(m: nn.Module) -> bool:\n    \"\"\"\n    Return `True` if `m` is a pooling layer or has one in its children\n    From: https://github.com/fastai/fastai/blob/master/fastai/vision/learner.py#L76\n    \"\"\"\n    if _is_pool_type(m):\n        return True\n    for l in m.children():\n        if has_pool_type(l):\n            return True\n    return False";
                var nbb_cells = Jupyter.notebook.get_cells();
                for (var i = 0; i < nbb_cells.length; ++i) {
                    if (nbb_cells[i].input_prompt_number == nbb_cell_id) {
                        if (nbb_cells[i].get_text() == nbb_unformatted_code) {
                             nbb_cells[i].set_text(nbb_formatted_code);
                        }
                        break;
                    }
                }
            }, 500);
            
</script>
</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="prepare_backbone" class="doc_header"><code>prepare_backbone</code><a href="https://github.com/benihime91/gale/tree/master/gale/classification/model/backbones.py#L54" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>prepare_backbone</code>(<strong><code>model</code></strong>:<code>Module</code>, <strong><code>cut</code></strong>=<em><code>None</code></em>)</p>
</blockquote>
<p>Cut off the body of a typically pretrained <code>model</code> as determined by <code>cut</code></p>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">




<div id="d0a30927-5ef1-4e4b-a3d6-e8f473ff37ef"></div>
<div class="output_subarea output_javascript ">
<script type="text/javascript">
var element = $('#d0a30927-5ef1-4e4b-a3d6-e8f473ff37ef');

            setTimeout(function() {
                var nbb_cell_id = 8;
                var nbb_unformatted_code = "# export\ndef prepare_backbone(model: nn.Module, cut=None):\n    \"Cut off the body of a typically pretrained `model` as determined by `cut`\"\n    if cut is None:\n        ll = list(enumerate(model.children()))\n        cut = next(i for i, o in reversed(ll) if has_pool_type(o))\n    if isinstance(cut, int):\n        return nn.Sequential(*list(model.children())[:cut])\n    elif callable(cut):\n        return cut(model)\n    else:\n        raise NamedError(\"cut must be either integer or a function\")";
                var nbb_formatted_code = "# export\ndef prepare_backbone(model: nn.Module, cut=None):\n    \"Cut off the body of a typically pretrained `model` as determined by `cut`\"\n    if cut is None:\n        ll = list(enumerate(model.children()))\n        cut = next(i for i, o in reversed(ll) if has_pool_type(o))\n    if isinstance(cut, int):\n        return nn.Sequential(*list(model.children())[:cut])\n    elif callable(cut):\n        return cut(model)\n    else:\n        raise NamedError(\"cut must be either integer or a function\")";
                var nbb_cells = Jupyter.notebook.get_cells();
                for (var i = 0; i < nbb_cells.length; ++i) {
                    if (nbb_cells[i].input_prompt_number == nbb_cell_id) {
                        if (nbb_cells[i].get_text() == nbb_unformatted_code) {
                             nbb_cells[i].set_text(nbb_formatted_code);
                        }
                        break;
                    }
                }
            }, 500);
            
</script>
</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">tst</span> <span class="o">=</span> <span class="n">nn</span><span class="o">.</span><span class="n">Sequential</span><span class="p">(</span><span class="n">nn</span><span class="o">.</span><span class="n">Conv2d</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">3</span><span class="p">),</span> <span class="n">nn</span><span class="o">.</span><span class="n">BatchNorm2d</span><span class="p">(</span><span class="mi">5</span><span class="p">),</span> <span class="n">nn</span><span class="o">.</span><span class="n">AvgPool2d</span><span class="p">(</span><span class="mi">1</span><span class="p">),</span> <span class="n">nn</span><span class="o">.</span><span class="n">Linear</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">))</span>

<span class="n">m</span> <span class="o">=</span> <span class="n">prepare_backbone</span><span class="p">(</span><span class="n">tst</span><span class="p">)</span>
<span class="n">test_eq</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">m</span><span class="p">),</span> <span class="mi">2</span><span class="p">)</span>

<span class="n">m</span> <span class="o">=</span> <span class="n">prepare_backbone</span><span class="p">(</span><span class="n">tst</span><span class="p">,</span> <span class="n">cut</span><span class="o">=</span><span class="mi">3</span><span class="p">)</span>
<span class="n">test_eq</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">m</span><span class="p">),</span> <span class="mi">3</span><span class="p">)</span>

<span class="n">m</span> <span class="o">=</span> <span class="n">prepare_backbone</span><span class="p">(</span><span class="n">tst</span><span class="p">,</span> <span class="n">cut</span><span class="o">=-</span><span class="mi">1</span><span class="p">)</span>
<span class="n">test_eq</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">m</span><span class="p">),</span> <span class="mi">3</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">




<div id="58dcd90a-b334-468b-bd8d-369e0d826bab"></div>
<div class="output_subarea output_javascript ">
<script type="text/javascript">
var element = $('#58dcd90a-b334-468b-bd8d-369e0d826bab');

            setTimeout(function() {
                var nbb_cell_id = 9;
                var nbb_unformatted_code = "# fmt: off\ntst = nn.Sequential(nn.Conv2d(3, 5, 3), nn.BatchNorm2d(5), nn.AvgPool2d(1), nn.Linear(3, 4))\n\nm = prepare_backbone(tst)\ntest_eq(len(m), 2)\n\nm = prepare_backbone(tst, cut=3)\ntest_eq(len(m), 3)\n\nm = prepare_backbone(tst, cut=-1)\ntest_eq(len(m), 3)";
                var nbb_formatted_code = "# fmt: off\ntst = nn.Sequential(nn.Conv2d(3, 5, 3), nn.BatchNorm2d(5), nn.AvgPool2d(1), nn.Linear(3, 4))\n\nm = prepare_backbone(tst)\ntest_eq(len(m), 2)\n\nm = prepare_backbone(tst, cut=3)\ntest_eq(len(m), 3)\n\nm = prepare_backbone(tst, cut=-1)\ntest_eq(len(m), 3)";
                var nbb_cells = Jupyter.notebook.get_cells();
                for (var i = 0; i < nbb_cells.length; ++i) {
                    if (nbb_cells[i].input_prompt_number == nbb_cell_id) {
                        if (nbb_cells[i].get_text() == nbb_unformatted_code) {
                             nbb_cells[i].set_text(nbb_formatted_code);
                        }
                        break;
                    }
                }
            }, 500);
            
</script>
</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="filter_weight_decay" class="doc_header"><code>filter_weight_decay</code><a href="https://github.com/benihime91/gale/tree/master/gale/classification/model/backbones.py#L67" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>filter_weight_decay</code>(<strong><code>model</code></strong>:<code>Module</code>, <strong><code>lr</code></strong>:<code>float</code>, <strong><code>weight_decay</code></strong>:<code>float</code>=<em><code>1e-05</code></em>, <strong><code>skip_list</code></strong>=<em><code>()</code></em>)</p>
</blockquote>
<p>Filter out bias, bn and other 1d params from weight decay.
Modified from: <a href="https://github.com/rwightman/pytorch-image-models/timm/optim/optim_factory.py">https://github.com/rwightman/pytorch-image-models/timm/optim/optim_factory.py</a></p>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">




<div id="64693c1e-b42b-4efc-ab96-7686c99a0ef6"></div>
<div class="output_subarea output_javascript ">
<script type="text/javascript">
var element = $('#64693c1e-b42b-4efc-ab96-7686c99a0ef6');

            setTimeout(function() {
                var nbb_cell_id = 10;
                var nbb_unformatted_code = "# export\ndef filter_weight_decay(\n    model: nn.Module,\n    lr: float,\n    weight_decay: float = 1e-5,\n    skip_list=(),\n) -> List[Dict]:\n    \"\"\"\n    Filter out bias, bn and other 1d params from weight decay.\n    Modified from: https://github.com/rwightman/pytorch-image-models/timm/optim/optim_factory.py\n    \"\"\"\n    decay = []\n    no_decay = []\n    for name, param in model.named_parameters():\n        if not param.requires_grad:\n            continue  # frozen weights\n        if len(param.shape) == 1 or name.endswith(\".bias\") or name in skip_list:\n            no_decay.append(param)\n        else:\n            decay.append(param)\n    return [\n        {\"params\": no_decay, \"weight_decay\": 0.0, \"lr\": lr},\n        {\"params\": decay, \"weight_decay\": weight_decay, \"lr\": lr},\n    ]";
                var nbb_formatted_code = "# export\ndef filter_weight_decay(\n    model: nn.Module,\n    lr: float,\n    weight_decay: float = 1e-5,\n    skip_list=(),\n) -> List[Dict]:\n    \"\"\"\n    Filter out bias, bn and other 1d params from weight decay.\n    Modified from: https://github.com/rwightman/pytorch-image-models/timm/optim/optim_factory.py\n    \"\"\"\n    decay = []\n    no_decay = []\n    for name, param in model.named_parameters():\n        if not param.requires_grad:\n            continue  # frozen weights\n        if len(param.shape) == 1 or name.endswith(\".bias\") or name in skip_list:\n            no_decay.append(param)\n        else:\n            decay.append(param)\n    return [\n        {\"params\": no_decay, \"weight_decay\": 0.0, \"lr\": lr},\n        {\"params\": decay, \"weight_decay\": weight_decay, \"lr\": lr},\n    ]";
                var nbb_cells = Jupyter.notebook.get_cells();
                for (var i = 0; i < nbb_cells.length; ++i) {
                    if (nbb_cells[i].input_prompt_number == nbb_cell_id) {
                        if (nbb_cells[i].get_text() == nbb_unformatted_code) {
                             nbb_cells[i].set_text(nbb_formatted_code);
                        }
                        break;
                    }
                }
            }, 500);
            
</script>
</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h2 id="ImageClassificationBackbone" class="doc_header"><code>class</code> <code>ImageClassificationBackbone</code><a href="https://github.com/benihime91/gale/tree/master/gale/classification/model/backbones.py#L92" class="source_link" style="float:right">[source]</a></h2><blockquote><p><code>ImageClassificationBackbone</code>() :: <a href="/gale/core-classes.html#BasicModule"><code>BasicModule</code></a></p>
</blockquote>
<p>Abstract class for ImageClassification BackBones</p>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">




<div id="08fe2640-d3f9-4a51-8fea-ccef62ee9928"></div>
<div class="output_subarea output_javascript ">
<script type="text/javascript">
var element = $('#08fe2640-d3f9-4a51-8fea-ccef62ee9928');

            setTimeout(function() {
                var nbb_cell_id = 11;
                var nbb_unformatted_code = "# export\nclass ImageClassificationBackbone(BasicModule):\n    \"\"\"\n    Abstract class for ImageClassification BackBones\n    \"\"\"\n\n    _hypers = namedtuple(\"hypers\", field_names=[\"lr\", \"wd\"])\n\n    def filter_params(self, parameters: List[Dict]):\n        \"\"\"Filters any empty paramter groups in `p`\"\"\"\n        pgs_filterd = []\n\n        for group in parameters:\n            if group[\"params\"] == []:\n                pass\n            else:\n                pgs_filterd += [group]\n        return pgs_filterd\n\n    @property\n    def hypers(self) -> Tuple:\n        \"\"\"\n        Returns list of parameters like `lr` and `wd`\n        for each param group\n        \"\"\"\n        lrs = []\n        wds = []\n\n        for p in self.build_param_dicts():\n            lrs.append(p[\"lr\"])\n            wds.append(p[\"weight_decay\"])\n        return self._hypers(lrs, wds)\n\n    def output_shape(self) -> ShapeSpec:\n        \"\"\"\n        Returns the output shape. For most backbones\n        this means it will contain the channels in the\n        output layer.\n        \"\"\"\n        pass";
                var nbb_formatted_code = "# export\nclass ImageClassificationBackbone(BasicModule):\n    \"\"\"\n    Abstract class for ImageClassification BackBones\n    \"\"\"\n\n    _hypers = namedtuple(\"hypers\", field_names=[\"lr\", \"wd\"])\n\n    def filter_params(self, parameters: List[Dict]):\n        \"\"\"Filters any empty paramter groups in `p`\"\"\"\n        pgs_filterd = []\n\n        for group in parameters:\n            if group[\"params\"] == []:\n                pass\n            else:\n                pgs_filterd += [group]\n        return pgs_filterd\n\n    @property\n    def hypers(self) -> Tuple:\n        \"\"\"\n        Returns list of parameters like `lr` and `wd`\n        for each param group\n        \"\"\"\n        lrs = []\n        wds = []\n\n        for p in self.build_param_dicts():\n            lrs.append(p[\"lr\"])\n            wds.append(p[\"weight_decay\"])\n        return self._hypers(lrs, wds)\n\n    def output_shape(self) -> ShapeSpec:\n        \"\"\"\n        Returns the output shape. For most backbones\n        this means it will contain the channels in the\n        output layer.\n        \"\"\"\n        pass";
                var nbb_cells = Jupyter.notebook.get_cells();
                for (var i = 0; i < nbb_cells.length; ++i) {
                    if (nbb_cells[i].input_prompt_number == nbb_cell_id) {
                        if (nbb_cells[i].get_text() == nbb_unformatted_code) {
                             nbb_cells[i].set_text(nbb_formatted_code);
                        }
                        break;
                    }
                }
            }, 500);
            
</script>
</div>

</div>

</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>Some <code>meta_arch</code>'s in gale require backbones and for image classsification all the backbones should inherit from <a href="/gale/classification.models.backbones.html#ImageClassificationBackbone"><code>ImageClassificationBackbone</code></a></p>

</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="k">class</span> <span class="nc">TstModule</span><span class="p">(</span><span class="n">ImageClassificationBackbone</span><span class="p">):</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">(</span><span class="n">TstModule</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="fm">__init__</span><span class="p">()</span>
        <span class="n">layers</span> <span class="o">=</span> <span class="p">[</span><span class="n">nn</span><span class="o">.</span><span class="n">Linear</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">),</span> <span class="n">nn</span><span class="o">.</span><span class="n">Linear</span><span class="p">(</span><span class="mi">4</span><span class="p">,</span> <span class="mi">5</span><span class="p">)]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">layers</span> <span class="o">=</span> <span class="n">nn</span><span class="o">.</span><span class="n">Sequential</span><span class="p">(</span><span class="o">*</span><span class="n">layers</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">forward</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">o</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">layers</span><span class="p">(</span><span class="n">o</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">output_shape</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">ShapeSpec</span><span class="p">(</span><span class="mi">4</span><span class="p">,</span> <span class="kc">None</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">build_param_dicts</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">p0</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;params&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">layers</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">parameters</span><span class="p">(),</span> <span class="s2">&quot;lr&quot;</span><span class="p">:</span> <span class="mf">1e-06</span><span class="p">,</span> <span class="s2">&quot;weight_decay&quot;</span><span class="p">:</span> <span class="mf">0.001</span><span class="p">}</span>
        <span class="n">p1</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;params&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">layers</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">parameters</span><span class="p">(),</span> <span class="s2">&quot;lr&quot;</span><span class="p">:</span> <span class="mf">1e-03</span><span class="p">,</span> <span class="s2">&quot;weight_decay&quot;</span><span class="p">:</span> <span class="mf">0.1</span><span class="p">}</span>
        <span class="k">return</span> <span class="p">[</span><span class="n">p0</span><span class="p">,</span> <span class="n">p1</span><span class="p">]</span>


<span class="n">tst</span> <span class="o">=</span> <span class="n">TstModule</span><span class="p">()</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">




<div id="1a652191-bf51-4517-9382-ff7f01fb5e25"></div>
<div class="output_subarea output_javascript ">
<script type="text/javascript">
var element = $('#1a652191-bf51-4517-9382-ff7f01fb5e25');

            setTimeout(function() {
                var nbb_cell_id = 12;
                var nbb_unformatted_code = "class TstModule(ImageClassificationBackbone):\n    def __init__(self):\n        super(TstModule, self).__init__()\n        layers = [nn.Linear(3, 4), nn.Linear(4, 5)]\n        self.layers = nn.Sequential(*layers)\n\n    def forward(self, o):\n        return self.layers(o)\n\n    def output_shape(self):\n        return ShapeSpec(4, None, None)\n\n    def build_param_dicts(self):\n        p0 = {\"params\": self.layers[0].parameters(), \"lr\": 1e-06, \"weight_decay\": 0.001}\n        p1 = {\"params\": self.layers[1].parameters(), \"lr\": 1e-03, \"weight_decay\": 0.1}\n        return [p0, p1]\n\n\ntst = TstModule()";
                var nbb_formatted_code = "class TstModule(ImageClassificationBackbone):\n    def __init__(self):\n        super(TstModule, self).__init__()\n        layers = [nn.Linear(3, 4), nn.Linear(4, 5)]\n        self.layers = nn.Sequential(*layers)\n\n    def forward(self, o):\n        return self.layers(o)\n\n    def output_shape(self):\n        return ShapeSpec(4, None, None)\n\n    def build_param_dicts(self):\n        p0 = {\"params\": self.layers[0].parameters(), \"lr\": 1e-06, \"weight_decay\": 0.001}\n        p1 = {\"params\": self.layers[1].parameters(), \"lr\": 1e-03, \"weight_decay\": 0.1}\n        return [p0, p1]\n\n\ntst = TstModule()";
                var nbb_cells = Jupyter.notebook.get_cells();
                for (var i = 0; i < nbb_cells.length; ++i) {
                    if (nbb_cells[i].input_prompt_number == nbb_cell_id) {
                        if (nbb_cells[i].get_text() == nbb_unformatted_code) {
                             nbb_cells[i].set_text(nbb_formatted_code);
                        }
                        break;
                    }
                }
            }, 500);
            
</script>
</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="ImageClassificationBackbone.hypers" class="doc_header"><code>ImageClassificationBackbone.hypers</code><a href="" class="source_link" style="float:right">[source]</a></h4><p>Returns list of parameters like <code>lr</code> and <code>wd</code>
for each param group</p>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">test_eq</span><span class="p">(</span><span class="n">tst</span><span class="o">.</span><span class="n">hypers</span><span class="o">.</span><span class="n">lr</span><span class="p">,</span> <span class="p">[</span><span class="mf">1e-06</span><span class="p">,</span> <span class="mf">1e-03</span><span class="p">])</span>
<span class="n">test_eq</span><span class="p">(</span><span class="n">tst</span><span class="o">.</span><span class="n">hypers</span><span class="o">.</span><span class="n">wd</span><span class="p">,</span> <span class="p">[</span><span class="mf">0.001</span><span class="p">,</span> <span class="mf">0.1</span><span class="p">])</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">




<div id="f00569aa-4a73-4a3a-bca0-c226970d4887"></div>
<div class="output_subarea output_javascript ">
<script type="text/javascript">
var element = $('#f00569aa-4a73-4a3a-bca0-c226970d4887');

            setTimeout(function() {
                var nbb_cell_id = 14;
                var nbb_unformatted_code = "test_eq(tst.hypers.lr, [1e-06, 1e-03])\ntest_eq(tst.hypers.wd, [0.001, 0.1])";
                var nbb_formatted_code = "test_eq(tst.hypers.lr, [1e-06, 1e-03])\ntest_eq(tst.hypers.wd, [0.001, 0.1])";
                var nbb_cells = Jupyter.notebook.get_cells();
                for (var i = 0; i < nbb_cells.length; ++i) {
                    if (nbb_cells[i].input_prompt_number == nbb_cell_id) {
                        if (nbb_cells[i].get_text() == nbb_unformatted_code) {
                             nbb_cells[i].set_text(nbb_formatted_code);
                        }
                        break;
                    }
                }
            }, 500);
            
</script>
</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="ImageClassificationBackbone.output_shape" class="doc_header"><code>ImageClassificationBackbone.output_shape</code><a href="https://github.com/benihime91/gale/tree/master/gale/classification/model/backbones.py#L124" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>ImageClassificationBackbone.output_shape</code>()</p>
</blockquote>
<p>Returns the output shape. For most backbones
this means it will contain the channels in the
output layer.</p>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="k">assert</span> <span class="n">tst</span><span class="o">.</span><span class="n">output_shape</span><span class="p">()</span> <span class="o">==</span> <span class="n">ShapeSpec</span><span class="p">(</span><span class="mi">4</span><span class="p">,</span> <span class="kc">None</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">




<div id="fab48057-15c6-4182-88f2-98943d9b250f"></div>
<div class="output_subarea output_javascript ">
<script type="text/javascript">
var element = $('#fab48057-15c6-4182-88f2-98943d9b250f');

            setTimeout(function() {
                var nbb_cell_id = 16;
                var nbb_unformatted_code = "assert tst.output_shape() == ShapeSpec(4, None, None)";
                var nbb_formatted_code = "assert tst.output_shape() == ShapeSpec(4, None, None)";
                var nbb_cells = Jupyter.notebook.get_cells();
                for (var i = 0; i < nbb_cells.length; ++i) {
                    if (nbb_cells[i].input_prompt_number == nbb_cell_id) {
                        if (nbb_cells[i].get_text() == nbb_unformatted_code) {
                             nbb_cells[i].set_text(nbb_formatted_code);
                        }
                        break;
                    }
                }
            }, 500);
            
</script>
</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="ImageClassificationBackbone.filter_params" class="doc_header"><code>ImageClassificationBackbone.filter_params</code><a href="https://github.com/benihime91/gale/tree/master/gale/classification/model/backbones.py#L99" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>ImageClassificationBackbone.filter_params</code>(<strong><code>parameters</code></strong>:<code>List</code>[<code>Dict</code>])</p>
</blockquote>
<p>Filters any empty paramter groups in <code>p</code></p>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h2 id="TimmBackboneBase" class="doc_header"><code>class</code> <code>TimmBackboneBase</code><a href="https://github.com/benihime91/gale/tree/master/gale/classification/model/backbones.py#L133" class="source_link" style="float:right">[source]</a></h2><blockquote><p><code>TimmBackboneBase</code>(<strong><code>model_name</code></strong>:<code>str</code>, <strong><code>input_shape</code></strong>:<code>ShapeSpec</code>, <strong><code>act</code></strong>:<code>str</code>=<em><code>None</code></em>, <strong><code>lr</code></strong>:<code>float</code>=<em><code>0.001</code></em>, <strong><code>wd</code></strong>:<code>float</code>=<em><code>0</code></em>, <strong><code>freeze_bn</code></strong>:<code>bool</code>=<em><code>False</code></em>, <strong><code>freeze_at</code></strong>:<code>int</code>=<em><code>False</code></em>, <strong><code>filter_wd</code></strong>:<code>bool</code>=<em><code>False</code></em>, <strong><code>pretrained</code></strong>=<em><code>True</code></em>, <strong><code>drop_block_rate</code></strong>=<em><code>None</code></em>, <strong><code>drop_path_rate</code></strong>=<em><code>None</code></em>, <strong><code>bn_tf</code></strong>=<em><code>False</code></em>, <strong>**<code>kwargs</code></strong>) :: <a href="/gale/classification.models.backbones.html#ImageClassificationBackbone"><code>ImageClassificationBackbone</code></a></p>
</blockquote>
<p>Create a model from <code>timm</code> and converts it into a Image Classification Backbone</p>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">




<div id="211c3261-0a2c-4a26-81e0-94c19f743102"></div>
<div class="output_subarea output_javascript ">
<script type="text/javascript">
var element = $('#211c3261-0a2c-4a26-81e0-94c19f743102');

            setTimeout(function() {
                var nbb_cell_id = 18;
                var nbb_unformatted_code = "# export\nclass TimmBackboneBase(ImageClassificationBackbone):\n    \"Create a model from `timm` and converts it into a Image Classification Backbone\"\n\n    @use_kwargs_dict(\n        keep=True,\n        pretrained=True,\n        drop_block_rate=None,\n        drop_path_rate=None,\n        bn_tf=False,\n    )\n    def __init__(\n        self,\n        model_name: str,\n        input_shape: ShapeSpec,\n        act: str = None,\n        lr: float = 1e-03,\n        wd: float = 0,\n        freeze_bn: bool = False,\n        freeze_at: int = False,\n        filter_wd: bool = False,\n        **kwargs,\n    ):\n        super(TimmBackboneBase, self).__init__()\n\n        store_attr(\"lr, wd, filter_wd, input_shape\")\n\n        if act is not None:\n            act = ACTIVATION_REGISTRY.get(act)\n\n        model = timm.create_model(\n            model_name,\n            act_layer=act,\n            global_pool=\"\",\n            num_classes=0,\n            in_chans=input_shape.channels,\n            **kwargs,\n        )\n\n        # save some of information from timm models\n        self.num_features = model.num_features\n        self.timm_model_cfg = model.default_cfg\n        self.model = prepare_backbone(model)\n\n        if not freeze_at:\n            self.unfreeze()\n        else:\n            self.freeze_to(freeze_at)\n\n        if freeze_bn:\n            set_bn_eval(self.model)\n\n    def forward(self, xb: torch.Tensor) -> torch.Tensor:\n        return self.model(xb)\n\n    def build_param_dicts(self) -> List:\n        if self.filter_wd:\n            ps = filter_weight_decay(self.model, lr=self.lr, weight_decay=self.wd)\n        else:\n            ps = {\n                \"params\": trainable_params(self.model),\n                \"lr\": self.lr,\n                \"weight_decay\": self.wd,\n            }\n            ps = [ps]\n\n        return self.filter_params(ps)\n\n    def output_shape(self) -> ShapeSpec:\n        return ShapeSpec(self.num_features, None, None)";
                var nbb_formatted_code = "# export\nclass TimmBackboneBase(ImageClassificationBackbone):\n    \"Create a model from `timm` and converts it into a Image Classification Backbone\"\n\n    @use_kwargs_dict(\n        keep=True,\n        pretrained=True,\n        drop_block_rate=None,\n        drop_path_rate=None,\n        bn_tf=False,\n    )\n    def __init__(\n        self,\n        model_name: str,\n        input_shape: ShapeSpec,\n        act: str = None,\n        lr: float = 1e-03,\n        wd: float = 0,\n        freeze_bn: bool = False,\n        freeze_at: int = False,\n        filter_wd: bool = False,\n        **kwargs,\n    ):\n        super(TimmBackboneBase, self).__init__()\n\n        store_attr(\"lr, wd, filter_wd, input_shape\")\n\n        if act is not None:\n            act = ACTIVATION_REGISTRY.get(act)\n\n        model = timm.create_model(\n            model_name,\n            act_layer=act,\n            global_pool=\"\",\n            num_classes=0,\n            in_chans=input_shape.channels,\n            **kwargs,\n        )\n\n        # save some of information from timm models\n        self.num_features = model.num_features\n        self.timm_model_cfg = model.default_cfg\n        self.model = prepare_backbone(model)\n\n        if not freeze_at:\n            self.unfreeze()\n        else:\n            self.freeze_to(freeze_at)\n\n        if freeze_bn:\n            set_bn_eval(self.model)\n\n    def forward(self, xb: torch.Tensor) -> torch.Tensor:\n        return self.model(xb)\n\n    def build_param_dicts(self) -> List:\n        if self.filter_wd:\n            ps = filter_weight_decay(self.model, lr=self.lr, weight_decay=self.wd)\n        else:\n            ps = {\n                \"params\": trainable_params(self.model),\n                \"lr\": self.lr,\n                \"weight_decay\": self.wd,\n            }\n            ps = [ps]\n\n        return self.filter_params(ps)\n\n    def output_shape(self) -> ShapeSpec:\n        return ShapeSpec(self.num_features, None, None)";
                var nbb_cells = Jupyter.notebook.get_cells();
                for (var i = 0; i < nbb_cells.length; ++i) {
                    if (nbb_cells[i].input_prompt_number == nbb_cell_id) {
                        if (nbb_cells[i].get_text() == nbb_unformatted_code) {
                             nbb_cells[i].set_text(nbb_formatted_code);
                        }
                        break;
                    }
                }
            }, 500);
            
</script>
</div>

</div>

</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>This class provides a simple way to load a model from timm using all it's arguments. It then cuts the model at the pooling layer before the classifier of the model .ie., we keep the feature extractor the feature extractor is converted to the backbone. You can optionally choose to partially or fully freeze the parameters groups of the backbone using <code>freeze_at</code>. <code>freeze_bn</code> sets the BatchNorm layers of the model to eval &amp; if <code>filter_wd</code> then the weight decay is not applied to bias and other 1d paramters of the backbone.</p>
<p><a href="/gale/classification.models.backbones.html#TimmBackboneBase.build_param_dics("><code>TimmBackboneBase.build_param_dics()</code></a>) is responsible to building the parameters of the model. Currently it returns the <a href="/gale/torch_utils.html#trainable_params"><code>trainable_params</code></a> of the model with <code>lr</code> and <code>wd</code>. The paramters are filterd with <code>wd</code> if <code>filter_wd</code>. For more advanced options you should probably override this method.</p>

</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p><strong>Arguments to <a href="/gale/classification.models.backbones.html#TimmBackboneBase"><code>TimmBackboneBase</code></a>:</strong></p>
<ul>
<li><code>input_shape</code> (ShapeSpec): Shape of the Inputs</li>
<li><code>model_name</code> (str): name of model to instantiate.</li>
<li><code>act</code> (str): name of the activation function to use. If None uses the default activations else the name must be in <a href="/gale/utils.structures.html#ACTIVATION_REGISTRY"><code>ACTIVATION_REGISTRY</code></a>.</li>
<li><code>lr</code> (float): learning rate for the modules.</li>
<li><code>wd</code> (float): weight decay for the modules.</li>
<li><code>freeze_bn</code> (bool): freeze the batch normalization layers of the model.</li>
<li><code>freeze_at</code> (int): freeze the layers of the backbone upto <code>freeze_at</code>, false means train all.</li>
<li><code>filter_wd</code> (bool): Filter out bias, bn from weight_decay.</li>
<li><code>pretrained</code> (bool): load pretrained ImageNet-1k weights if true.</li>
<li><code>drop_block_rate</code> (float): Drop block rate</li>
<li><code>drop_path_rate</code> (float): Drop_path_rate</li>
<li><code>bn_tf</code> (bool): Use Tensorflow BatchNorm defaults for models that support it.</li>
<li><code>kwargs</code> (optional): Optional kwargs passed onto <code>timm.create_model()</code></li>
</ul>

</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">input_shape</span> <span class="o">=</span> <span class="n">ShapeSpec</span><span class="p">(</span><span class="n">channels</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span> <span class="n">height</span><span class="o">=</span><span class="mi">255</span><span class="p">,</span> <span class="n">width</span><span class="o">=</span><span class="mi">255</span><span class="p">)</span>
<span class="n">bk</span> <span class="o">=</span> <span class="n">TimmBackboneBase</span><span class="p">(</span><span class="n">model_name</span><span class="o">=</span><span class="s2">&quot;resnet18&quot;</span><span class="p">,</span> <span class="n">pretrained</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">input_shape</span><span class="o">=</span><span class="n">input_shape</span><span class="p">)</span>
<span class="n">m</span> <span class="o">=</span> <span class="n">timm</span><span class="o">.</span><span class="n">create_model</span><span class="p">(</span><span class="s2">&quot;resnet18&quot;</span><span class="p">)</span>

<span class="n">i</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">randn</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">224</span><span class="p">,</span> <span class="mi">224</span><span class="p">)</span>
<span class="n">o1</span> <span class="o">=</span> <span class="n">bk</span><span class="p">(</span><span class="n">i</span><span class="p">)</span>
<span class="n">test_eq</span><span class="p">(</span><span class="n">o1</span><span class="o">.</span><span class="n">shape</span><span class="p">,</span> <span class="n">torch</span><span class="o">.</span><span class="n">Size</span><span class="p">([</span><span class="mi">2</span><span class="p">,</span> <span class="mi">512</span><span class="p">,</span> <span class="mi">7</span><span class="p">,</span> <span class="mi">7</span><span class="p">]))</span>
<span class="n">test_eq</span><span class="p">(</span><span class="n">bk</span><span class="o">.</span><span class="n">output_shape</span><span class="p">()</span><span class="o">.</span><span class="n">channels</span><span class="p">,</span> <span class="n">m</span><span class="o">.</span><span class="n">num_features</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">

<div class="output_subarea output_stream output_stderr output_text">
<pre>Loading pretrained weights from url (https://download.pytorch.org/models/resnet18-5c106cde.pth)
</pre>
</div>
</div>

<div class="output_area">




<div id="d8d3352f-ad48-4ca6-91f9-349f088116ac"></div>
<div class="output_subarea output_javascript ">
<script type="text/javascript">
var element = $('#d8d3352f-ad48-4ca6-91f9-349f088116ac');

            setTimeout(function() {
                var nbb_cell_id = 19;
                var nbb_unformatted_code = "input_shape = ShapeSpec(channels=3, height=255, width=255)\nbk = TimmBackboneBase(model_name=\"resnet18\", pretrained=True, input_shape=input_shape)\nm = timm.create_model(\"resnet18\")\n\ni = torch.randn(2, 3, 224, 224)\no1 = bk(i)\ntest_eq(o1.shape, torch.Size([2, 512, 7, 7]))\ntest_eq(bk.output_shape().channels, m.num_features)";
                var nbb_formatted_code = "input_shape = ShapeSpec(channels=3, height=255, width=255)\nbk = TimmBackboneBase(model_name=\"resnet18\", pretrained=True, input_shape=input_shape)\nm = timm.create_model(\"resnet18\")\n\ni = torch.randn(2, 3, 224, 224)\no1 = bk(i)\ntest_eq(o1.shape, torch.Size([2, 512, 7, 7]))\ntest_eq(bk.output_shape().channels, m.num_features)";
                var nbb_cells = Jupyter.notebook.get_cells();
                for (var i = 0; i < nbb_cells.length; ++i) {
                    if (nbb_cells[i].input_prompt_number == nbb_cell_id) {
                        if (nbb_cells[i].get_text() == nbb_unformatted_code) {
                             nbb_cells[i].set_text(nbb_formatted_code);
                        }
                        break;
                    }
                }
            }, 500);
            
</script>
</div>

</div>

</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h3 id="Dataclass">Dataclass<a class="anchor-link" href="#Dataclass"> </a></h3>
</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h2 id="TimmBackboneDataClass" class="doc_header"><code>class</code> <code>TimmBackboneDataClass</code><a href="https://github.com/benihime91/gale/tree/master/gale/classification/model/backbones.py#L205" class="source_link" style="float:right">[source]</a></h2><blockquote><p><code>TimmBackboneDataClass</code>(<strong><code>model_name</code></strong>:<code>str</code>=<em><code>'???'</code></em>, <strong><code>act</code></strong>:<code>Optional</code>[<code>str</code>]=<em><code>None</code></em>, <strong><code>lr</code></strong>:<code>Any</code>=<em><code>0.001</code></em>, <strong><code>wd</code></strong>:<code>Any</code>=<em><code>0.0</code></em>, <strong><code>freeze_bn</code></strong>:<code>bool</code>=<em><code>False</code></em>, <strong><code>freeze_at</code></strong>:<code>Any</code>=<em><code>False</code></em>, <strong><code>filter_wd</code></strong>:<code>bool</code>=<em><code>False</code></em>, <strong><code>pretrained</code></strong>:<code>bool</code>=<em><code>True</code></em>, <strong><code>drop_block_rate</code></strong>:<code>Optional</code>[<code>float</code>]=<em><code>None</code></em>, <strong><code>drop_path_rate</code></strong>:<code>Optional</code>[<code>float</code>]=<em><code>None</code></em>, <strong><code>bn_tf</code></strong>:<code>bool</code>=<em><code>False</code></em>)</p>
</blockquote>
<p>Base config file for <a href="/gale/classification.models.backbones.html#TimmBackboneBase"><code>TimmBackboneBase</code></a>. You need to pass in a
<code>model_name</code> the opter parameters are optional.</p>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">




<div id="2558281c-86b4-48bc-bb43-3f0d856b6a7a"></div>
<div class="output_subarea output_javascript ">
<script type="text/javascript">
var element = $('#2558281c-86b4-48bc-bb43-3f0d856b6a7a');

            setTimeout(function() {
                var nbb_cell_id = 20;
                var nbb_unformatted_code = "# export\n@dataclass\nclass TimmBackboneDataClass:\n    \"\"\"\n    Base config file for `TimmBackboneBase`. You need to pass in a\n    `model_name` the opter parameters are optional.\n    \"\"\"\n\n    model_name: str = MISSING\n    act: Optional[str] = None\n    lr: Any = 1e-03\n    wd: Any = 0.0\n    freeze_bn: bool = False\n    freeze_at: Any = False\n    filter_wd: bool = False\n    pretrained: bool = True\n    drop_block_rate: Optional[float] = None\n    drop_path_rate: Optional[float] = None\n    bn_tf: bool = False";
                var nbb_formatted_code = "# export\n@dataclass\nclass TimmBackboneDataClass:\n    \"\"\"\n    Base config file for `TimmBackboneBase`. You need to pass in a\n    `model_name` the opter parameters are optional.\n    \"\"\"\n\n    model_name: str = MISSING\n    act: Optional[str] = None\n    lr: Any = 1e-03\n    wd: Any = 0.0\n    freeze_bn: bool = False\n    freeze_at: Any = False\n    filter_wd: bool = False\n    pretrained: bool = True\n    drop_block_rate: Optional[float] = None\n    drop_path_rate: Optional[float] = None\n    bn_tf: bool = False";
                var nbb_cells = Jupyter.notebook.get_cells();
                for (var i = 0; i < nbb_cells.length; ++i) {
                    if (nbb_cells[i].input_prompt_number == nbb_cell_id) {
                        if (nbb_cells[i].get_text() == nbb_unformatted_code) {
                             nbb_cells[i].set_text(nbb_formatted_code);
                        }
                        break;
                    }
                }
            }, 500);
            
</script>
</div>

</div>

</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>The config for <code>TimmBackboneBaseConfig</code> is going to look like this. We need to convert the dataclass to the Omegaconf config file and then we can use <code>from_config_dict</code> method to instantiate our class ...</p>

</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">conf</span> <span class="o">=</span> <span class="n">TimmBackboneDataClass</span><span class="p">(</span><span class="n">model_name</span><span class="o">=</span><span class="s2">&quot;resnet18&quot;</span><span class="p">,</span> <span class="n">pretrained</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="n">conf</span> <span class="o">=</span> <span class="n">OmegaConf</span><span class="o">.</span><span class="n">structured</span><span class="p">(</span><span class="n">conf</span><span class="p">)</span>

<span class="c1"># we need to explicitely pass in the input_shape argument</span>
<span class="n">m</span> <span class="o">=</span> <span class="n">TimmBackboneBase</span><span class="o">.</span><span class="n">from_config_dict</span><span class="p">(</span><span class="n">conf</span><span class="p">,</span> <span class="n">input_shape</span><span class="o">=</span><span class="n">input_shape</span><span class="p">)</span>

<span class="n">o2</span> <span class="o">=</span> <span class="n">m</span><span class="p">(</span><span class="n">i</span><span class="p">)</span>
<span class="n">test_eq</span><span class="p">(</span><span class="n">o2</span><span class="o">.</span><span class="n">shape</span><span class="p">,</span> <span class="n">torch</span><span class="o">.</span><span class="n">Size</span><span class="p">([</span><span class="mi">2</span><span class="p">,</span> <span class="mi">512</span><span class="p">,</span> <span class="mi">7</span><span class="p">,</span> <span class="mi">7</span><span class="p">]))</span>

<span class="n">test_eq</span><span class="p">(</span><span class="n">o1</span><span class="o">.</span><span class="n">data</span><span class="p">,</span> <span class="n">o2</span><span class="o">.</span><span class="n">data</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">

<div class="output_subarea output_stream output_stderr output_text">
<pre>Loading pretrained weights from url (https://download.pytorch.org/models/resnet18-5c106cde.pth)
</pre>
</div>
</div>

<div class="output_area">




<div id="3b49ca9a-0ffc-4c30-91a3-2ead87cbd31c"></div>
<div class="output_subarea output_javascript ">
<script type="text/javascript">
var element = $('#3b49ca9a-0ffc-4c30-91a3-2ead87cbd31c');

            setTimeout(function() {
                var nbb_cell_id = 21;
                var nbb_unformatted_code = "# create a config to instantiate the same backbone as above\nconf = TimmBackboneDataClass(model_name=\"resnet18\", pretrained=True)\nconf = OmegaConf.structured(conf)\n\n# we need to explicitely pass in the input_shape argument\nm = TimmBackboneBase.from_config_dict(conf, input_shape=input_shape)\n\no2 = m(i)\ntest_eq(o2.shape, torch.Size([2, 512, 7, 7]))\n\ntest_eq(o1.data, o2.data)";
                var nbb_formatted_code = "# create a config to instantiate the same backbone as above\nconf = TimmBackboneDataClass(model_name=\"resnet18\", pretrained=True)\nconf = OmegaConf.structured(conf)\n\n# we need to explicitely pass in the input_shape argument\nm = TimmBackboneBase.from_config_dict(conf, input_shape=input_shape)\n\no2 = m(i)\ntest_eq(o2.shape, torch.Size([2, 512, 7, 7]))\n\ntest_eq(o1.data, o2.data)";
                var nbb_cells = Jupyter.notebook.get_cells();
                for (var i = 0; i < nbb_cells.length; ++i) {
                    if (nbb_cells[i].input_prompt_number == nbb_cell_id) {
                        if (nbb_cells[i].get_text() == nbb_unformatted_code) {
                             nbb_cells[i].set_text(nbb_formatted_code);
                        }
                        break;
                    }
                }
            }, 500);
            
</script>
</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h2 id="ResNetBackbone" class="doc_header"><code>class</code> <code>ResNetBackbone</code><a href="https://github.com/benihime91/gale/tree/master/gale/classification/model/backbones.py#L224" class="source_link" style="float:right">[source]</a></h2><blockquote><p><code>ResNetBackbone</code>(<strong><code>model_name</code></strong>:<code>str</code>, <strong><code>input_shape</code></strong>:<code>ShapeSpec</code>, <strong><code>act</code></strong>:<code>str</code>=<em><code>None</code></em>, <strong><code>lr</code></strong>:<code>float</code>=<em><code>0.001</code></em>, <strong><code>wd</code></strong>:<code>float</code>=<em><code>0.01</code></em>, <strong><code>lr_div</code></strong>:<code>float</code>=<em><code>100</code></em>, <strong><code>freeze_at</code></strong>:<code>int</code>=<em><code>0</code></em>, <strong><code>freeze_bn</code></strong>:<code>bool</code>=<em><code>False</code></em>, <strong><code>pretrained</code></strong>=<em><code>True</code></em>, <strong><code>drop_block_rate</code></strong>=<em><code>0.0</code></em>, <strong><code>drop_path_rate</code></strong>=<em><code>0.0</code></em>, <strong>**<code>kwargs</code></strong>) :: <a href="/gale/classification.models.backbones.html#ImageClassificationBackbone"><code>ImageClassificationBackbone</code></a></p>
</blockquote>
<p>A Backbone for ResNet based models from timm. Note: this class
does supports all the models listed
<a href="https://github.com/rwightman/pytorch-image-models/blob/e8a64fb88108b592da192e98054095b1ee25e96e/timm/models/resnet.py">here</a></p>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">




<div id="dc5185e1-96a6-483a-b256-ab54e742efba"></div>
<div class="output_subarea output_javascript ">
<script type="text/javascript">
var element = $('#dc5185e1-96a6-483a-b256-ab54e742efba');

            setTimeout(function() {
                var nbb_cell_id = 22;
                var nbb_unformatted_code = "# export\nclass ResNetBackbone(ImageClassificationBackbone):\n    \"\"\"\n    A Backbone for ResNet based models from timm. Note: this class\n    does supports all the models listed\n    [here](https://github.com/rwightman/pytorch-image-models/blob/e8a64fb88108b592da192e98054095b1ee25e96e/timm/models/resnet.py)\n    \"\"\"\n\n    @use_kwargs_dict(\n        keep=True,\n        pretrained=True,\n        drop_block_rate=0.0,\n        drop_path_rate=0.0,\n    )\n    def __init__(\n        self,\n        model_name: str,\n        input_shape: ShapeSpec,\n        act: str = None,\n        lr: float = 1e-03,\n        wd: float = 1e-02,\n        lr_div: float = 100,\n        freeze_at: int = 0,\n        freeze_bn: bool = False,\n        **kwargs,\n    ):\n        super(ResNetBackbone, self).__init__()\n        store_attr(\"freeze_at, wd, lr, lr_div, input_shape, freeze_bn\")\n\n        if act is not None:\n            act = ACTIVATION_REGISTRY.get(act)\n\n        model = timm.create_model(\n            model_name,\n            act_layer=act,\n            global_pool=\"\",\n            num_classes=0,\n            in_chans=input_shape.channels,\n            **kwargs,\n        )\n\n        assert isinstance(model, ResNet), \"ResNetBackbone supports only ResNet models\"\n        # save some of the input information from timm models\n        self.num_features = model.num_features\n        self.timm_model_cfg = model.default_cfg\n\n        # break up the model\n        # the stem for the resnet model consists of a convolutional block, norm, act, pool\n        stem = nn.Sequential(model.conv1, model.bn1, model.act1, model.maxpool)\n\n        # stages will consisit of the remaining 4 layers\n        stages = [model.layer1, model.layer2, model.layer3, model.layer4]\n        stages = nn.Sequential(*stages)\n\n        # creat the module\n        self.resnet = nn.Sequential(stem, stages)\n        self.prepare_model(self.resnet)\n\n    def forward(self, x: torch.Tensor) -> torch.Tensor:\n        return self.resnet(x)\n\n    def build_param_dicts(self) -> Any:\n        # model split according to https://github.com/fastai/fastai/blob/master/fastai/vision/learner.py\n        p0 = {\n            \"params\": trainable_params(self.resnet[0])\n            + trainable_params(self.resnet[1][:3]),\n            \"weight_decay\": self.wd,\n        }\n        p1 = {\"params\": trainable_params(self.resnet[1][3:]), \"weight_decay\": self.wd}\n        ps = [p0, p1]\n        ps, _ = build_discriminative_lrs(ps, self.lr, self.lr / self.lr_div)\n        return self.filter_params(ps)\n\n    def freeze_block(self, m: nn.Module):\n        \"\"\"\n        Make this block `m` not trainable.\n        \"\"\"\n        for p in m.parameters():\n            p.requires_grad = False\n        m.eval()\n\n    def prepare_model(self, m: nn.Module):\n        \"\"\"\n        Freeze the first several stages of the `ResNet`. Commonly used in fine-tuning.\n        \"\"\"\n        if self.freeze_at >= 1:\n            _logger.debug(\"Freezing stem\")\n            # freeze the stem of the model\n            self.freeze_block(m[0])\n\n        # freeze the blocks of the model according to\n        # freeze_at\n        for idx, stage in enumerate(m[1], start=2):\n            if self.freeze_at >= idx:\n                _logger.debug(f\"Freezing ResBlock {idx - 2 }\")\n                for block in stage.children():\n                    self.freeze_block(block)\n\n        if self.freeze_bn:\n            set_bn_eval(m)\n\n    def output_shape(self) -> ShapeSpec:\n        return ShapeSpec(self.num_features, None, None)";
                var nbb_formatted_code = "# export\nclass ResNetBackbone(ImageClassificationBackbone):\n    \"\"\"\n    A Backbone for ResNet based models from timm. Note: this class\n    does supports all the models listed\n    [here](https://github.com/rwightman/pytorch-image-models/blob/e8a64fb88108b592da192e98054095b1ee25e96e/timm/models/resnet.py)\n    \"\"\"\n\n    @use_kwargs_dict(\n        keep=True,\n        pretrained=True,\n        drop_block_rate=0.0,\n        drop_path_rate=0.0,\n    )\n    def __init__(\n        self,\n        model_name: str,\n        input_shape: ShapeSpec,\n        act: str = None,\n        lr: float = 1e-03,\n        wd: float = 1e-02,\n        lr_div: float = 100,\n        freeze_at: int = 0,\n        freeze_bn: bool = False,\n        **kwargs,\n    ):\n        super(ResNetBackbone, self).__init__()\n        store_attr(\"freeze_at, wd, lr, lr_div, input_shape, freeze_bn\")\n\n        if act is not None:\n            act = ACTIVATION_REGISTRY.get(act)\n\n        model = timm.create_model(\n            model_name,\n            act_layer=act,\n            global_pool=\"\",\n            num_classes=0,\n            in_chans=input_shape.channels,\n            **kwargs,\n        )\n\n        assert isinstance(model, ResNet), \"ResNetBackbone supports only ResNet models\"\n        # save some of the input information from timm models\n        self.num_features = model.num_features\n        self.timm_model_cfg = model.default_cfg\n\n        # break up the model\n        # the stem for the resnet model consists of a convolutional block, norm, act, pool\n        stem = nn.Sequential(model.conv1, model.bn1, model.act1, model.maxpool)\n\n        # stages will consisit of the remaining 4 layers\n        stages = [model.layer1, model.layer2, model.layer3, model.layer4]\n        stages = nn.Sequential(*stages)\n\n        # creat the module\n        self.resnet = nn.Sequential(stem, stages)\n        self.prepare_model(self.resnet)\n\n    def forward(self, x: torch.Tensor) -> torch.Tensor:\n        return self.resnet(x)\n\n    def build_param_dicts(self) -> Any:\n        # model split according to https://github.com/fastai/fastai/blob/master/fastai/vision/learner.py\n        p0 = {\n            \"params\": trainable_params(self.resnet[0])\n            + trainable_params(self.resnet[1][:3]),\n            \"weight_decay\": self.wd,\n        }\n        p1 = {\"params\": trainable_params(self.resnet[1][3:]), \"weight_decay\": self.wd}\n        ps = [p0, p1]\n        ps, _ = build_discriminative_lrs(ps, self.lr, self.lr / self.lr_div)\n        return self.filter_params(ps)\n\n    def freeze_block(self, m: nn.Module):\n        \"\"\"\n        Make this block `m` not trainable.\n        \"\"\"\n        for p in m.parameters():\n            p.requires_grad = False\n        m.eval()\n\n    def prepare_model(self, m: nn.Module):\n        \"\"\"\n        Freeze the first several stages of the `ResNet`. Commonly used in fine-tuning.\n        \"\"\"\n        if self.freeze_at >= 1:\n            _logger.debug(\"Freezing stem\")\n            # freeze the stem of the model\n            self.freeze_block(m[0])\n\n        # freeze the blocks of the model according to\n        # freeze_at\n        for idx, stage in enumerate(m[1], start=2):\n            if self.freeze_at >= idx:\n                _logger.debug(f\"Freezing ResBlock {idx - 2 }\")\n                for block in stage.children():\n                    self.freeze_block(block)\n\n        if self.freeze_bn:\n            set_bn_eval(m)\n\n    def output_shape(self) -> ShapeSpec:\n        return ShapeSpec(self.num_features, None, None)";
                var nbb_cells = Jupyter.notebook.get_cells();
                for (var i = 0; i < nbb_cells.length; ++i) {
                    if (nbb_cells[i].input_prompt_number == nbb_cell_id) {
                        if (nbb_cells[i].get_text() == nbb_unformatted_code) {
                             nbb_cells[i].set_text(nbb_formatted_code);
                        }
                        break;
                    }
                }
            }, 500);
            
</script>
</div>

</div>

</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p><strong>Arguments to <a href="/gale/classification.models.backbones.html#ResNetBackbone"><code>ResNetBackbone</code></a></strong>:</p>
<ul>
<li><code>input_shape</code> (ShapeSpec): Shape of the Inputs</li>
<li><code>model_name</code> (str): name of model to instantiate.</li>
<li><code>act</code> (str): name of the activation function to use. If None uses the default activations else the name must be in <a href="/gale/utils.structures.html#ACTIVATION_REGISTRY"><code>ACTIVATION_REGISTRY</code></a>.</li>
<li><code>lr</code> (float): learning rate for the modules.</li>
<li><code>lr_div</code> (int, float): factor for discriminative lrs.   </li>
<li><code>wd</code> (float): weight decay for the modules.</li>
<li><code>freeze_at</code> (int): Freeze the first several stages of the ResNet. Commonly used in fine-tuning. <code>1</code> means freezing the stem. <code>2</code> means freezing the stem and one residual stage, etc.</li>
<li><code>pretrained</code> (bool): load pretrained ImageNet-1k weights if true.</li>
<li><code>drop_block_rate</code> (float): Drop block rate.</li>
<li><code>drop_path_rate</code> (float): Drop path rate.</li>
<li><code>bn_tf</code> (bool): Use Tensorflow BatchNorm defaults for models that support it.</li>
<li><code>kwargs</code> (optional): Optional kwargs passed onto <code>timm.create_model()</code></li>
</ul>

</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p><a href="/gale/classification.models.backbones.html#ResNetBackbone"><code>ResNetBackbone</code></a> is a <a href="/gale/classification.models.backbones.html#ImageClassificationBackbone"><code>ImageClassificationBackbone</code></a> class that is resposible to converting ResNet based models into a appropriate backbone for Image Classification tasks.</p>
<p>Note that each resnet block at 1 stem and 4 convolutional blocks in the model. You can freeze some or all of these blocks by setting <code>freeze_at</code>. If <code>0</code> then the whole model is traininable. <code>1</code> freezes only the stem, <code>2</code> freezes the stem and a block and so on. We also train the ResNet model using discriminative Lr's for finetuning.
So the 3 and 4 blocks are trained with a learning rate of <code>lr</code> and the stem, 1 block, 2 block are trained with learning rates <code>lr</code>/<code>lr_div</code>. Weight decay <code>wd</code> is applied to the whole model.</p>

</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="ResNetBackbone.prepare_model" class="doc_header"><code>ResNetBackbone.prepare_model</code><a href="https://github.com/benihime91/gale/tree/master/gale/classification/model/backbones.py#L304" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>ResNetBackbone.prepare_model</code>(<strong><code>m</code></strong>:<code>Module</code>)</p>
</blockquote>
<p>Freeze the first several stages of the <code>ResNet</code>. Commonly used in fine-tuning.</p>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="ResNetBackbone.freeze_block" class="doc_header"><code>ResNetBackbone.freeze_block</code><a href="https://github.com/benihime91/gale/tree/master/gale/classification/model/backbones.py#L296" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>ResNetBackbone.freeze_block</code>(<strong><code>m</code></strong>:<code>Module</code>)</p>
</blockquote>
<p>Make this block <code>m</code> not trainable.</p>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h3 id="Dataclass">Dataclass<a class="anchor-link" href="#Dataclass"> </a></h3>
</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>This class can be instantiated from a config as follows -</p>

</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h2 id="ResNetBackboneDataClass" class="doc_header"><code>class</code> <code>ResNetBackboneDataClass</code><a href="https://github.com/benihime91/gale/tree/master/gale/classification/model/backbones.py#L329" class="source_link" style="float:right">[source]</a></h2><blockquote><p><code>ResNetBackboneDataClass</code>(<strong><code>model_name</code></strong>:<code>str</code>=<em><code>'???'</code></em>, <strong><code>act</code></strong>:<code>Optional</code>[<code>str</code>]=<em><code>None</code></em>, <strong><code>lr</code></strong>:<code>Any</code>=<em><code>0.001</code></em>, <strong><code>lr_div</code></strong>:<code>Any</code>=<em><code>10</code></em>, <strong><code>wd</code></strong>:<code>Any</code>=<em><code>0.0</code></em>, <strong><code>freeze_at</code></strong>:<code>int</code>=<em><code>0</code></em>, <strong><code>pretrained</code></strong>:<code>bool</code>=<em><code>True</code></em>, <strong><code>drop_block_rate</code></strong>:<code>Optional</code>[<code>float</code>]=<em><code>None</code></em>, <strong><code>drop_path_rate</code></strong>:<code>Optional</code>[<code>float</code>]=<em><code>None</code></em>, <strong><code>bn_tf</code></strong>:<code>bool</code>=<em><code>False</code></em>)</p>
</blockquote>
<p>Base config file for <a href="/gale/classification.models.backbones.html#ResNetBackbone"><code>ResNetBackbone</code></a></p>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">




<div id="476458a0-d152-424f-86aa-8722c9fbfe9c"></div>
<div class="output_subarea output_javascript ">
<script type="text/javascript">
var element = $('#476458a0-d152-424f-86aa-8722c9fbfe9c');

            setTimeout(function() {
                var nbb_cell_id = 25;
                var nbb_unformatted_code = "# export\n@dataclass\nclass ResNetBackboneDataClass:\n    \"\"\"\n    Base config file for `ResNetBackbone`\n    \"\"\"\n\n    model_name: str = MISSING\n    act: Optional[str] = None\n    lr: Any = 1e-03\n    lr_div: Any = 10\n    wd: Any = 0.0\n    freeze_at: int = 0\n    pretrained: bool = True\n    drop_block_rate: Optional[float] = None\n    drop_path_rate: Optional[float] = None\n    bn_tf: bool = False";
                var nbb_formatted_code = "# export\n@dataclass\nclass ResNetBackboneDataClass:\n    \"\"\"\n    Base config file for `ResNetBackbone`\n    \"\"\"\n\n    model_name: str = MISSING\n    act: Optional[str] = None\n    lr: Any = 1e-03\n    lr_div: Any = 10\n    wd: Any = 0.0\n    freeze_at: int = 0\n    pretrained: bool = True\n    drop_block_rate: Optional[float] = None\n    drop_path_rate: Optional[float] = None\n    bn_tf: bool = False";
                var nbb_cells = Jupyter.notebook.get_cells();
                for (var i = 0; i < nbb_cells.length; ++i) {
                    if (nbb_cells[i].input_prompt_number == nbb_cell_id) {
                        if (nbb_cells[i].get_text() == nbb_unformatted_code) {
                             nbb_cells[i].set_text(nbb_formatted_code);
                        }
                        break;
                    }
                }
            }, 500);
            
</script>
</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">conf</span> <span class="o">=</span> <span class="n">OmegaConf</span><span class="o">.</span><span class="n">structured</span><span class="p">(</span><span class="n">ResNetBackboneDataClass</span><span class="p">(</span><span class="n">model_name</span><span class="o">=</span><span class="s2">&quot;resnet34&quot;</span><span class="p">))</span>
<span class="c1"># instantiate cls from config</span>
<span class="n">m</span> <span class="o">=</span> <span class="n">ResNetBackbone</span><span class="o">.</span><span class="n">from_config_dict</span><span class="p">(</span><span class="n">conf</span><span class="p">,</span> <span class="n">input_shape</span><span class="o">=</span><span class="n">input_shape</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">

<div class="output_subarea output_stream output_stderr output_text">
<pre>Loading pretrained weights from url (https://github.com/rwightman/pytorch-image-models/releases/download/v0.1-weights/resnet34-43635321.pth)
</pre>
</div>
</div>

<div class="output_area">




<div id="36e66603-362c-467d-8c0a-ca5bd7408c31"></div>
<div class="output_subarea output_javascript ">
<script type="text/javascript">
var element = $('#36e66603-362c-467d-8c0a-ca5bd7408c31');

            setTimeout(function() {
                var nbb_cell_id = 26;
                var nbb_unformatted_code = "# create config from OmegaConf using `ResNetBackboneConfig` dataclass\nconf = OmegaConf.structured(ResNetBackboneDataClass(model_name=\"resnet34\"))\n# instantiate cls from config\nm = ResNetBackbone.from_config_dict(conf, input_shape=input_shape)";
                var nbb_formatted_code = "# create config from OmegaConf using `ResNetBackboneConfig` dataclass\nconf = OmegaConf.structured(ResNetBackboneDataClass(model_name=\"resnet34\"))\n# instantiate cls from config\nm = ResNetBackbone.from_config_dict(conf, input_shape=input_shape)";
                var nbb_cells = Jupyter.notebook.get_cells();
                for (var i = 0; i < nbb_cells.length; ++i) {
                    if (nbb_cells[i].input_prompt_number == nbb_cell_id) {
                        if (nbb_cells[i].get_text() == nbb_unformatted_code) {
                             nbb_cells[i].set_text(nbb_formatted_code);
                        }
                        break;
                    }
                }
            }, 500);
            
</script>
</div>

</div>

</div>
</div>

</div>
    {% endraw %}

</div>
 

