---

title: Meta Architectures : Generalized Image Classifier 


keywords: fastai
sidebar: home_sidebar

summary: "Default Model Architectures for Image Classification"
description: "Default Model Architectures for Image Classification"
nb_path: "nbs/04b_classification.modelling.meta_arch.common.ipynb"
---
<!--

#################################################
### THIS FILE WAS AUTOGENERATED! DO NOT EDIT! ###
#################################################
# file to edit: nbs/04b_classification.modelling.meta_arch.common.ipynb
# command to build the docs after a change: nbdev_build_docs

-->

<div class="container" id="notebook-container">
        
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="kn">from</span> <span class="nn">gale.core.utils.logger</span> <span class="kn">import</span> <span class="n">setup_logger</span>

<span class="n">setup_logger</span><span class="p">()</span>
<span class="n">_logger</span> <span class="o">=</span> <span class="n">logging</span><span class="o">.</span><span class="n">getLogger</span><span class="p">(</span><span class="s2">&quot;gale.classification.modelling.meta_arch.common&quot;</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">




<div id="2f7bf0e4-4e81-4340-86c0-e22d260a3ec1"></div>
<div class="output_subarea output_javascript ">
<script type="text/javascript">
var element = $('#2f7bf0e4-4e81-4340-86c0-e22d260a3ec1');

            setTimeout(function() {
                var nbb_cell_id = 5;
                var nbb_unformatted_code = "from gale.core.utils.logger import setup_logger\n\nsetup_logger()\n_logger = logging.getLogger(\"gale.classification.modelling.meta_arch.common\")";
                var nbb_formatted_code = "from gale.core.utils.logger import setup_logger\n\nsetup_logger()\n_logger = logging.getLogger(\"gale.classification.modelling.meta_arch.common\")";
                var nbb_cells = Jupyter.notebook.get_cells();
                for (var i = 0; i < nbb_cells.length; ++i) {
                    if (nbb_cells[i].input_prompt_number == nbb_cell_id) {
                        if (nbb_cells[i].get_text() == nbb_unformatted_code) {
                             nbb_cells[i].set_text(nbb_formatted_code);
                        }
                        break;
                    }
                }
            }, 500);
            
</script>
</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">




<div id="93f91041-1da7-4c4e-9fbb-758e1c887f43"></div>
<div class="output_subarea output_javascript ">
<script type="text/javascript">
var element = $('#93f91041-1da7-4c4e-9fbb-758e1c887f43');

            setTimeout(function() {
                var nbb_cell_id = 6;
                var nbb_unformatted_code = "# export\nclass GeneralizedImageClassifier(GaleModule):\n    \"\"\"\n    A General Image Classifier. Any models that contains the following 2 components:\n    1. Feature extractor (aka backbone)\n    2. Image Classification head (Pooling + Classifier)\n    \"\"\"\n\n    def __init__(\n        self,\n        backbone: ImageClassificationBackbone,\n        head: ImageClassificationHead,\n    ):\n        \"\"\"\n        Arguments:\n        1. `backbone`: a `ImageClassificationBackbone` module, must follow gale's backbone interface\n        2. `head`: a head containg the classifier. and the pooling layer, must be an instance of\n        `ImageClassificationHead`.\n        \"\"\"\n        super(GeneralizedImageClassifier, self).__init__()\n        self.backbone = backbone\n        assert isinstance(backbone, ImageClassificationBackbone)\n        self.head = head\n        assert isinstance(head, ImageClassificationHead)\n\n    def forward(self, batched_inputs: torch.Tensor) -> torch.Tensor:\n        \"\"\"\n        Runs the batched_inputs through `backbone` followed by the `head`.\n        Returns a Tensor which contains the logits for the batched_inputs.\n        \"\"\"\n        out = self.backbone(batched_inputs)\n        out = self.head(out)\n        return out\n\n    @classmethod\n    def from_config_dict(cls, cfg: DictConfig):\n        \"\"\"\n        Instantiate the Meta Architecture from gale config\n        \"\"\"\n        # fmt: off\n        \n        if not hasattr(cfg.model, \"backbone\"):\n            _logger.error(\"Configuration for model backbone not found\")\n            raise ValueError\n            \n        if not hasattr(cfg.model, \"head\"):\n            _logger.error(\"Configuration for model head not found\")\n            raise ValueError\n            \n        input_shape = ShapeSpec(cfg.input.channels, cfg.input.height, cfg.input.width)\n        _logger.info(f\"Inputs: {input_shape}\")\n        \n        backbone = build_backbone(cfg, input_shape=input_shape)\n        param_count = get_human_readable_count(sum([m.numel() for m in backbone.parameters()]))\n        _logger.info('Backbone {} created, param count: {}.'.format(cfg.model.backbone.name, param_count))\n        \n        head = build_head(cfg, backbone.output_shape())\n        param_count = get_human_readable_count(sum([m.numel() for m in head.parameters()]))\n        _logger.info('Head {} created, param count: {}.'.format(cfg.model.head.name, param_count))\n        \n        kwds = {\"backbone\": backbone, \"head\": head}\n        \n        instance = cls(**kwds)\n        instance._cfg = OmegaConf.to_container(cfg.model, resolve=True)\n        instance.input_shape = input_shape\n        param_count = get_human_readable_count(sum([m.numel() for m in instance.parameters()]))\n        _logger.info(\"Model created, param count: {}.\".format(param_count))\n        # fmt: on\n        return instance\n\n    def build_param_dicts(self):\n        \"\"\"\n        Builds up the Paramters dicts for optimization.\n        \"\"\"\n        backbone_params = self.backbone.build_param_dicts()\n        head_params = self.head.build_param_dicts()\n        return backbone_params + head_params\n\n    def get_lrs(self) -> List:\n        \"\"\"\n        Returns a List containining the Lrs' for\n        each parameter group. This is required to build schedulers\n        like `torch.optim.lr_scheduler.OneCycleScheduler` which needs\n        the max lrs' for all the Param Groups.\n        \"\"\"\n        lrs = []\n\n        for p in self.build_param_dicts():\n            lrs.append(p[\"lr\"])\n        return lrs";
                var nbb_formatted_code = "# export\nclass GeneralizedImageClassifier(GaleModule):\n    \"\"\"\n    A General Image Classifier. Any models that contains the following 2 components:\n    1. Feature extractor (aka backbone)\n    2. Image Classification head (Pooling + Classifier)\n    \"\"\"\n\n    def __init__(\n        self,\n        backbone: ImageClassificationBackbone,\n        head: ImageClassificationHead,\n    ):\n        \"\"\"\n        Arguments:\n        1. `backbone`: a `ImageClassificationBackbone` module, must follow gale's backbone interface\n        2. `head`: a head containg the classifier. and the pooling layer, must be an instance of\n        `ImageClassificationHead`.\n        \"\"\"\n        super(GeneralizedImageClassifier, self).__init__()\n        self.backbone = backbone\n        assert isinstance(backbone, ImageClassificationBackbone)\n        self.head = head\n        assert isinstance(head, ImageClassificationHead)\n\n    def forward(self, batched_inputs: torch.Tensor) -> torch.Tensor:\n        \"\"\"\n        Runs the batched_inputs through `backbone` followed by the `head`.\n        Returns a Tensor which contains the logits for the batched_inputs.\n        \"\"\"\n        out = self.backbone(batched_inputs)\n        out = self.head(out)\n        return out\n\n    @classmethod\n    def from_config_dict(cls, cfg: DictConfig):\n        \"\"\"\n        Instantiate the Meta Architecture from gale config\n        \"\"\"\n        # fmt: off\n        \n        if not hasattr(cfg.model, \"backbone\"):\n            _logger.error(\"Configuration for model backbone not found\")\n            raise ValueError\n            \n        if not hasattr(cfg.model, \"head\"):\n            _logger.error(\"Configuration for model head not found\")\n            raise ValueError\n            \n        input_shape = ShapeSpec(cfg.input.channels, cfg.input.height, cfg.input.width)\n        _logger.info(f\"Inputs: {input_shape}\")\n        \n        backbone = build_backbone(cfg, input_shape=input_shape)\n        param_count = get_human_readable_count(sum([m.numel() for m in backbone.parameters()]))\n        _logger.info('Backbone {} created, param count: {}.'.format(cfg.model.backbone.name, param_count))\n        \n        head = build_head(cfg, backbone.output_shape())\n        param_count = get_human_readable_count(sum([m.numel() for m in head.parameters()]))\n        _logger.info('Head {} created, param count: {}.'.format(cfg.model.head.name, param_count))\n        \n        kwds = {\"backbone\": backbone, \"head\": head}\n        \n        instance = cls(**kwds)\n        instance._cfg = OmegaConf.to_container(cfg.model, resolve=True)\n        instance.input_shape = input_shape\n        param_count = get_human_readable_count(sum([m.numel() for m in instance.parameters()]))\n        _logger.info(\"Model created, param count: {}.\".format(param_count))\n        # fmt: on\n        return instance\n\n    def build_param_dicts(self):\n        \"\"\"\n        Builds up the Paramters dicts for optimization.\n        \"\"\"\n        backbone_params = self.backbone.build_param_dicts()\n        head_params = self.head.build_param_dicts()\n        return backbone_params + head_params\n\n    def get_lrs(self) -> List:\n        \"\"\"\n        Returns a List containining the Lrs' for\n        each parameter group. This is required to build schedulers\n        like `torch.optim.lr_scheduler.OneCycleScheduler` which needs\n        the max lrs' for all the Param Groups.\n        \"\"\"\n        lrs = []\n\n        for p in self.build_param_dicts():\n            lrs.append(p[\"lr\"])\n        return lrs";
                var nbb_cells = Jupyter.notebook.get_cells();
                for (var i = 0; i < nbb_cells.length; ++i) {
                    if (nbb_cells[i].input_prompt_number == nbb_cell_id) {
                        if (nbb_cells[i].get_text() == nbb_unformatted_code) {
                             nbb_cells[i].set_text(nbb_formatted_code);
                        }
                        break;
                    }
                }
            }, 500);
            
</script>
</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h2 id="GeneralizedImageClassifier" class="doc_header"><code>class</code> <code>GeneralizedImageClassifier</code><a href="https://github.com/benihime91/gale/tree/master/gale/classification/modelling/meta_arch/common.py#L23" class="source_link" style="float:right">[source]</a></h2><blockquote><p><code>GeneralizedImageClassifier</code>(<strong><code>backbone</code></strong>:<a href="/gale/classification.modelling.backbones.html#ImageClassificationBackbone"><code>ImageClassificationBackbone</code></a>, <strong><code>head</code></strong>:<a href="/gale/classification.modelling.heads.html#ImageClassificationHead"><code>ImageClassificationHead</code></a>) :: <a href="/gale/core.classes.html#GaleModule"><code>GaleModule</code></a></p>
</blockquote>
<p>A General Image Classifier. Any models that contains the following 2 components:</p>
<ol>
<li>Feature extractor (aka backbone)</li>
<li>Image Classification head (Pooling + Classifier)</li>
</ol>

</div>

</div>

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="GeneralizedImageClassifier.__init__" class="doc_header"><code>GeneralizedImageClassifier.__init__</code><a href="https://github.com/benihime91/gale/tree/master/gale/classification/modelling/meta_arch/common.py#L30" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>GeneralizedImageClassifier.__init__</code>(<strong><code>backbone</code></strong>:<a href="/gale/classification.modelling.backbones.html#ImageClassificationBackbone"><code>ImageClassificationBackbone</code></a>, <strong><code>head</code></strong>:<a href="/gale/classification.modelling.heads.html#ImageClassificationHead"><code>ImageClassificationHead</code></a>)</p>
</blockquote>
<p>Arguments:</p>
<ol>
<li><code>backbone</code>: a <a href="/gale/classification.modelling.backbones.html#ImageClassificationBackbone"><code>ImageClassificationBackbone</code></a> module, must follow gale's backbone interface</li>
<li><code>head</code>: a head containg the classifier. and the pooling layer, must be an instance of
<a href="/gale/classification.modelling.heads.html#ImageClassificationHead"><code>ImageClassificationHead</code></a>.</li>
</ol>

</div>

</div>

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="GeneralizedImageClassifier.from_config_dict" class="doc_header"><code>GeneralizedImageClassifier.from_config_dict</code><a href="https://github.com/benihime91/gale/tree/master/gale/classification/modelling/meta_arch/common.py#L56" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>GeneralizedImageClassifier.from_config_dict</code>(<strong><code>cfg</code></strong>:<code>DictConfig</code>)</p>
</blockquote>
<p>Instantiate the Meta Architecture from gale config</p>

</div>

</div>

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="GeneralizedImageClassifier.forward" class="doc_header"><code>GeneralizedImageClassifier.forward</code><a href="https://github.com/benihime91/gale/tree/master/gale/classification/modelling/meta_arch/common.py#L47" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>GeneralizedImageClassifier.forward</code>(<strong><code>batched_inputs</code></strong>:<code>Tensor</code>)</p>
</blockquote>
<p>Runs the batched_inputs through <code>backbone</code> followed by the <code>head</code>.
Returns a Tensor which contains the logits for the batched_inputs.</p>

</div>

</div>

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="GeneralizedImageClassifier.build_param_dicts" class="doc_header"><code>GeneralizedImageClassifier.build_param_dicts</code><a href="https://github.com/benihime91/gale/tree/master/gale/classification/modelling/meta_arch/common.py#L92" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>GeneralizedImageClassifier.build_param_dicts</code>()</p>
</blockquote>
<p>Builds up the Paramters dicts for optimization.</p>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>{% include note.html content='Any Custom Meta Architecture that you build should inherit from <a href="/gale/core.classes.html#GaleModule"><code>GaleModule</code></a> and must be registered in <a href="/gale/core.utils.structures.html#META_ARCH_REGISTRY"><code>META_ARCH_REGISTRY</code></a>.' %}</p>

</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h3 id="Instantiation-via-config">Instantiation via config<a class="anchor-link" href="#Instantiation-via-config"> </a></h3>
</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="kn">from</span> <span class="nn">dataclasses</span> <span class="kn">import</span> <span class="n">dataclass</span><span class="p">,</span> <span class="n">field</span>
<span class="kn">from</span> <span class="nn">omegaconf</span> <span class="kn">import</span> <span class="n">MISSING</span><span class="p">,</span> <span class="n">OmegaConf</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">




<div id="7615ae53-2ac2-44ed-be8a-5efb6e2c5409"></div>
<div class="output_subarea output_javascript ">
<script type="text/javascript">
var element = $('#7615ae53-2ac2-44ed-be8a-5efb6e2c5409');

            setTimeout(function() {
                var nbb_cell_id = 8;
                var nbb_unformatted_code = "from dataclasses import dataclass, field\nfrom omegaconf import MISSING, OmegaConf";
                var nbb_formatted_code = "from dataclasses import dataclass, field\nfrom omegaconf import MISSING, OmegaConf";
                var nbb_cells = Jupyter.notebook.get_cells();
                for (var i = 0; i < nbb_cells.length; ++i) {
                    if (nbb_cells[i].input_prompt_number == nbb_cell_id) {
                        if (nbb_cells[i].get_text() == nbb_unformatted_code) {
                             nbb_cells[i].set_text(nbb_formatted_code);
                        }
                        break;
                    }
                }
            }, 500);
            
</script>
</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="nd">@dataclass</span>
<span class="k">class</span> <span class="nc">BackboneConf</span><span class="p">:</span>
    <span class="n">model_name</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;resnet18&quot;</span>
    <span class="n">act</span><span class="p">:</span> <span class="n">Any</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="n">lr</span><span class="p">:</span> <span class="n">Any</span> <span class="o">=</span> <span class="mf">1e-03</span>
    <span class="n">lr_div</span><span class="p">:</span> <span class="n">Any</span> <span class="o">=</span> <span class="mi">10</span>
    <span class="n">wd</span><span class="p">:</span> <span class="n">Any</span> <span class="o">=</span> <span class="mf">0.0</span>
    <span class="n">freeze_at</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">2</span>
    <span class="n">pretrained</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span>
    <span class="n">drop_block_rate</span><span class="p">:</span> <span class="n">Any</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="n">drop_path_rate</span><span class="p">:</span> <span class="n">Any</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="n">bn_tf</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span>


<span class="nd">@dataclass</span>
<span class="k">class</span> <span class="nc">HeadConf</span><span class="p">:</span>
    <span class="n">num_classes</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="n">MISSING</span>
    <span class="n">act</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;ReLU&quot;</span>
    <span class="n">lin_ftrs</span><span class="p">:</span> <span class="n">Any</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="n">ps</span><span class="p">:</span> <span class="n">Any</span> <span class="o">=</span> <span class="mf">0.5</span>
    <span class="n">concat_pool</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span>
    <span class="n">first_bn</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span>
    <span class="n">bn_final</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span>
    <span class="n">lr</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">0.002</span>
    <span class="n">wd</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="n">filter_wd</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span>


<span class="n">b_args</span> <span class="o">=</span> <span class="n">OmegaConf</span><span class="o">.</span><span class="n">structured</span><span class="p">(</span><span class="n">BackboneConf</span><span class="p">())</span>
<span class="n">h_args</span> <span class="o">=</span> <span class="n">OmegaConf</span><span class="o">.</span><span class="n">structured</span><span class="p">(</span><span class="n">HeadConf</span><span class="p">(</span><span class="n">num_classes</span><span class="o">=</span><span class="mi">10</span><span class="p">))</span>

<span class="c1"># Backbone config</span>
<span class="n">b</span> <span class="o">=</span> <span class="n">OmegaConf</span><span class="o">.</span><span class="n">create</span><span class="p">()</span>
<span class="n">b</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="s2">&quot;ResNetBackbone&quot;</span>
<span class="n">b</span><span class="o">.</span><span class="n">init_args</span> <span class="o">=</span> <span class="n">b_args</span>

<span class="c1"># Head config</span>
<span class="n">h</span> <span class="o">=</span> <span class="n">OmegaConf</span><span class="o">.</span><span class="n">create</span><span class="p">()</span>
<span class="n">h</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="s2">&quot;FastaiHead&quot;</span>
<span class="n">h</span><span class="o">.</span><span class="n">init_args</span> <span class="o">=</span> <span class="n">h_args</span>

<span class="n">i</span> <span class="o">=</span> <span class="n">OmegaConf</span><span class="o">.</span><span class="n">create</span><span class="p">()</span>
<span class="n">i</span><span class="o">.</span><span class="n">channels</span> <span class="o">=</span> <span class="mi">3</span>
<span class="n">i</span><span class="o">.</span><span class="n">height</span> <span class="o">=</span> <span class="mi">224</span>
<span class="n">i</span><span class="o">.</span><span class="n">width</span> <span class="o">=</span> <span class="mi">224</span>

<span class="n">m</span> <span class="o">=</span> <span class="n">OmegaConf</span><span class="o">.</span><span class="n">create</span><span class="p">()</span>
<span class="n">m</span><span class="o">.</span><span class="n">backbone</span> <span class="o">=</span> <span class="n">b</span>
<span class="n">m</span><span class="o">.</span><span class="n">head</span> <span class="o">=</span> <span class="n">h</span>

<span class="c1"># config</span>
<span class="n">conf</span> <span class="o">=</span> <span class="n">OmegaConf</span><span class="o">.</span><span class="n">create</span><span class="p">(</span><span class="nb">dict</span><span class="p">(</span><span class="nb">input</span><span class="o">=</span><span class="n">i</span><span class="p">,</span> <span class="n">model</span><span class="o">=</span><span class="n">m</span><span class="p">))</span>
<span class="n">conf</span> <span class="o">=</span> <span class="n">OmegaConf</span><span class="o">.</span><span class="n">structured</span><span class="p">(</span><span class="n">conf</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">




<div id="893780ff-7614-4fcf-977f-4d26b8bea33d"></div>
<div class="output_subarea output_javascript ">
<script type="text/javascript">
var element = $('#893780ff-7614-4fcf-977f-4d26b8bea33d');

            setTimeout(function() {
                var nbb_cell_id = 9;
                var nbb_unformatted_code = "@dataclass\nclass BackboneConf:\n    model_name: str = \"resnet18\"\n    act: Any = None\n    lr: Any = 1e-03\n    lr_div: Any = 10\n    wd: Any = 0.0\n    freeze_at: int = 2\n    pretrained: bool = True\n    drop_block_rate: Any = None\n    drop_path_rate: Any = None\n    bn_tf: bool = False\n\n\n@dataclass\nclass HeadConf:\n    num_classes: int = MISSING\n    act: str = \"ReLU\"\n    lin_ftrs: Any = None\n    ps: Any = 0.5\n    concat_pool: bool = True\n    first_bn: bool = True\n    bn_final: bool = False\n    lr: float = 0.002\n    wd: float = 0\n    filter_wd: bool = False\n\n\nb_args = OmegaConf.structured(BackboneConf())\nh_args = OmegaConf.structured(HeadConf(num_classes=10))\n\n# Backbone config\nb = OmegaConf.create()\nb.name = \"ResNetBackbone\"\nb.init_args = b_args\n\n# Head config\nh = OmegaConf.create()\nh.name = \"FastaiHead\"\nh.init_args = h_args\n\ni = OmegaConf.create()\ni.channels = 3\ni.height = 224\ni.width = 224\n\nm = OmegaConf.create()\nm.backbone = b\nm.head = h\n\n# config\nconf = OmegaConf.create(dict(input=i, model=m))\nconf = OmegaConf.structured(conf)";
                var nbb_formatted_code = "@dataclass\nclass BackboneConf:\n    model_name: str = \"resnet18\"\n    act: Any = None\n    lr: Any = 1e-03\n    lr_div: Any = 10\n    wd: Any = 0.0\n    freeze_at: int = 2\n    pretrained: bool = True\n    drop_block_rate: Any = None\n    drop_path_rate: Any = None\n    bn_tf: bool = False\n\n\n@dataclass\nclass HeadConf:\n    num_classes: int = MISSING\n    act: str = \"ReLU\"\n    lin_ftrs: Any = None\n    ps: Any = 0.5\n    concat_pool: bool = True\n    first_bn: bool = True\n    bn_final: bool = False\n    lr: float = 0.002\n    wd: float = 0\n    filter_wd: bool = False\n\n\nb_args = OmegaConf.structured(BackboneConf())\nh_args = OmegaConf.structured(HeadConf(num_classes=10))\n\n# Backbone config\nb = OmegaConf.create()\nb.name = \"ResNetBackbone\"\nb.init_args = b_args\n\n# Head config\nh = OmegaConf.create()\nh.name = \"FastaiHead\"\nh.init_args = h_args\n\ni = OmegaConf.create()\ni.channels = 3\ni.height = 224\ni.width = 224\n\nm = OmegaConf.create()\nm.backbone = b\nm.head = h\n\n# config\nconf = OmegaConf.create(dict(input=i, model=m))\nconf = OmegaConf.structured(conf)";
                var nbb_cells = Jupyter.notebook.get_cells();
                for (var i = 0; i < nbb_cells.length; ++i) {
                    if (nbb_cells[i].input_prompt_number == nbb_cell_id) {
                        if (nbb_cells[i].get_text() == nbb_unformatted_code) {
                             nbb_cells[i].set_text(nbb_formatted_code);
                        }
                        break;
                    }
                }
            }, 500);
            
</script>
</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">m</span> <span class="o">=</span> <span class="n">GeneralizedImageClassifier</span><span class="o">.</span><span class="n">from_config_dict</span><span class="p">(</span><span class="n">conf</span><span class="p">)</span>

<span class="n">inp</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">randn</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="n">m</span><span class="o">.</span><span class="n">input_shape</span><span class="o">.</span><span class="n">channels</span><span class="p">,</span> <span class="n">m</span><span class="o">.</span><span class="n">input_shape</span><span class="o">.</span><span class="n">height</span><span class="p">,</span> <span class="n">m</span><span class="o">.</span><span class="n">input_shape</span><span class="o">.</span><span class="n">width</span><span class="p">)</span>
<span class="n">o</span> <span class="o">=</span> <span class="n">m</span><span class="p">(</span><span class="n">inp</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre><span class="ansi-green-fg">[04/24 23:40:47 gale.classification.modelling.meta_arch.common]: </span>Inputs: ShapeSpec(channels=3, height=224, width=224)
<span class="ansi-green-fg">[04/24 23:40:48 gale.classification.modelling.meta_arch.common]: </span>Backbone ResNetBackbone created, param count: 11.2 M.
<span class="ansi-green-fg">[04/24 23:40:48 gale.classification.modelling.meta_arch.common]: </span>Head FastaiHead created, param count: 532 K.
<span class="ansi-green-fg">[04/24 23:40:48 gale.classification.modelling.meta_arch.common]: </span>Model created, param count: 11.7 M.
</pre>
</div>
</div>

<div class="output_area">




<div id="6a0e71fc-2ddc-43fa-ae91-91280a51f8be"></div>
<div class="output_subarea output_javascript ">
<script type="text/javascript">
var element = $('#6a0e71fc-2ddc-43fa-ae91-91280a51f8be');

            setTimeout(function() {
                var nbb_cell_id = 10;
                var nbb_unformatted_code = "m = GeneralizedImageClassifier.from_config_dict(conf)\n\ninp = torch.randn(2, m.input_shape.channels, m.input_shape.height, m.input_shape.width)\no = m(inp)";
                var nbb_formatted_code = "m = GeneralizedImageClassifier.from_config_dict(conf)\n\ninp = torch.randn(2, m.input_shape.channels, m.input_shape.height, m.input_shape.width)\no = m(inp)";
                var nbb_cells = Jupyter.notebook.get_cells();
                for (var i = 0; i < nbb_cells.length; ++i) {
                    if (nbb_cells[i].input_prompt_number == nbb_cell_id) {
                        if (nbb_cells[i].get_text() == nbb_unformatted_code) {
                             nbb_cells[i].set_text(nbb_formatted_code);
                        }
                        break;
                    }
                }
            }, 500);
            
</script>
</div>

</div>

</div>
</div>

</div>
    {% endraw %}

</div>
 

