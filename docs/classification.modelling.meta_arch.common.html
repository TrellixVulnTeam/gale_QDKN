---

title: Meta Architectures : Generalized Image Classifier 


keywords: fastai
sidebar: home_sidebar

summary: "Default Model Architecture for Image Classification"
description: "Default Model Architecture for Image Classification"
nb_path: "nbs/04b_classification.modelling.meta_arch.common.ipynb"
---
<!--

#################################################
### THIS FILE WAS AUTOGENERATED! DO NOT EDIT! ###
#################################################
# file to edit: nbs/04b_classification.modelling.meta_arch.common.ipynb
# command to build the docs after a change: nbdev_build_docs

-->

<div class="container" id="notebook-container">
        
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h2 id="GeneralizedImageClassifier" class="doc_header"><code>class</code> <code>GeneralizedImageClassifier</code><a href="https://github.com/benihime91/gale/tree/master/gale/classification/modelling/meta_arch/common.py#L23" class="source_link" style="float:right">[source]</a></h2><blockquote><p><code>GeneralizedImageClassifier</code>(<strong><code>backbone</code></strong>:<a href="/gale/classification.modelling.backbones.html#ImageClassificationBackbone"><code>ImageClassificationBackbone</code></a>, <strong><code>head</code></strong>:<a href="/gale/classification.modelling.heads.html#ImageClassificationHead"><code>ImageClassificationHead</code></a>) :: <a href="/gale/core.classes.html#GaleModule"><code>GaleModule</code></a></p>
</blockquote>
<p>A General Image Classifier. Any models that contains the following 2 components:</p>
<ol>
<li>Feature extractor (aka backbone)</li>
<li>Image Classification head (Pooling + Classifier)</li>
</ol>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">




<div id="e964fac4-791d-4411-afe2-ab304f7cba07"></div>
<div class="output_subarea output_javascript ">
<script type="text/javascript">
var element = $('#e964fac4-791d-4411-afe2-ab304f7cba07');

            setTimeout(function() {
                var nbb_cell_id = 5;
                var nbb_unformatted_code = "# export\nclass GeneralizedImageClassifier(GaleModule):\n    \"\"\"\n    A General Image Classifier. Any models that contains the following 2 components:\n    1. Feature extractor (aka backbone)\n    2. Image Classification head (Pooling + Classifier)\n    \"\"\"\n\n    def __init__(\n        self,\n        backbone: ImageClassificationBackbone,\n        head: ImageClassificationHead,\n    ):\n        \"\"\"\n        Arguments:\n        1. `backbone`: a `ImageClassificationBackbone` module, must follow gale's backbone interface\n        2. `head`: a head containg the classifier. and the pooling layer, must be an instance of\n        `ImageClassificationHead`.\n        \"\"\"\n        super(GeneralizedImageClassifier, self).__init__()\n        self.backbone = backbone\n        assert isinstance(backbone, ImageClassificationBackbone)\n        self.head = head\n        assert isinstance(head, ImageClassificationHead)\n\n    def forward(self, batched_inputs: torch.Tensor) -> torch.Tensor:\n        \"\"\"\n        Runs the batched_inputs through `backbone` followed by the `head`.\n        Returns a Tensor which contains the logits for the batched_inputs.\n        \"\"\"\n        # forward pass through the backbone\n        out = self.backbone(batched_inputs)\n        # pass through the classification layer\n        out = self.head(out)\n        return out\n\n    @classmethod\n    def from_config_dict(cls, cfg: DictConfig):\n        \"\"\"\n        Instantiate the Meta Architecture from gale config\n        \"\"\"\n        if not hasattr(cfg.model, \"backbone\"):\n            raise ValueError(\"Configuration for model backbone not found\")\n\n        if not hasattr(cfg.model, \"head\"):\n            raise ValueError(\"Configuration for model head not found\")\n\n        input_shape = ShapeSpec(cfg.input.channels, cfg.input.height, cfg.input.width)\n        _logger.debug(f\"Inputs: {input_shape}\")\n\n        backbone = build_backbone(cfg, input_shape=input_shape)\n        param_count = get_human_readable_count(\n            sum([m.numel() for m in backbone.parameters()])\n        )\n        _logger.debug(\n            \"Backbone {} created, param count: {}.\".format(\n                cfg.model.backbone.name, param_count\n            )\n        )\n\n        head = build_head(cfg, backbone.output_shape())\n        param_count = get_human_readable_count(\n            sum([m.numel() for m in head.parameters()])\n        )\n        _logger.debug(\n            \"Head {} created, param count: {}.\".format(cfg.model.head.name, param_count)\n        )\n\n        kwds = {\"backbone\": backbone, \"head\": head}\n\n        instance = cls(**kwds)\n        instance.input_shape = input_shape\n\n        param_count = get_human_readable_count(\n            sum([m.numel() for m in instance.parameters()])\n        )\n        _logger.info(\"Model created, param count: {}.\".format(param_count))\n\n        return instance\n\n    def build_param_dicts(self):\n        \"\"\"\n        Builds up the Paramters dicts for optimization\n        \"\"\"\n        backbone_params = self.backbone.build_param_dicts()\n        head_params = self.head.build_param_dicts()\n        parameters = backbone_params + head_params\n\n        # filter and remove any empty paramter groups if any\n        pgs_filterd = []\n\n        for group in parameters:\n            if group[\"params\"] == []:\n                pass\n            else:\n                pgs_filterd += [group]\n        return pgs_filterd\n\n    def get_lrs(self) -> List:\n        \"\"\"\n        Returns a List containining the Lrs' for\n        each parameter group. This is required to build schedulers\n        like `torch.optim.lr_scheduler.OneCycleScheduler` which needs\n        the max lrs' for all the Param Groups.\n        \"\"\"\n        lrs = []\n        for p in self.build_param_dicts():\n            lrs.append(p[\"lr\"])\n        return lrs";
                var nbb_formatted_code = "# export\nclass GeneralizedImageClassifier(GaleModule):\n    \"\"\"\n    A General Image Classifier. Any models that contains the following 2 components:\n    1. Feature extractor (aka backbone)\n    2. Image Classification head (Pooling + Classifier)\n    \"\"\"\n\n    def __init__(\n        self,\n        backbone: ImageClassificationBackbone,\n        head: ImageClassificationHead,\n    ):\n        \"\"\"\n        Arguments:\n        1. `backbone`: a `ImageClassificationBackbone` module, must follow gale's backbone interface\n        2. `head`: a head containg the classifier. and the pooling layer, must be an instance of\n        `ImageClassificationHead`.\n        \"\"\"\n        super(GeneralizedImageClassifier, self).__init__()\n        self.backbone = backbone\n        assert isinstance(backbone, ImageClassificationBackbone)\n        self.head = head\n        assert isinstance(head, ImageClassificationHead)\n\n    def forward(self, batched_inputs: torch.Tensor) -> torch.Tensor:\n        \"\"\"\n        Runs the batched_inputs through `backbone` followed by the `head`.\n        Returns a Tensor which contains the logits for the batched_inputs.\n        \"\"\"\n        # forward pass through the backbone\n        out = self.backbone(batched_inputs)\n        # pass through the classification layer\n        out = self.head(out)\n        return out\n\n    @classmethod\n    def from_config_dict(cls, cfg: DictConfig):\n        \"\"\"\n        Instantiate the Meta Architecture from gale config\n        \"\"\"\n        if not hasattr(cfg.model, \"backbone\"):\n            raise ValueError(\"Configuration for model backbone not found\")\n\n        if not hasattr(cfg.model, \"head\"):\n            raise ValueError(\"Configuration for model head not found\")\n\n        input_shape = ShapeSpec(cfg.input.channels, cfg.input.height, cfg.input.width)\n        _logger.debug(f\"Inputs: {input_shape}\")\n\n        backbone = build_backbone(cfg, input_shape=input_shape)\n        param_count = get_human_readable_count(\n            sum([m.numel() for m in backbone.parameters()])\n        )\n        _logger.debug(\n            \"Backbone {} created, param count: {}.\".format(\n                cfg.model.backbone.name, param_count\n            )\n        )\n\n        head = build_head(cfg, backbone.output_shape())\n        param_count = get_human_readable_count(\n            sum([m.numel() for m in head.parameters()])\n        )\n        _logger.debug(\n            \"Head {} created, param count: {}.\".format(cfg.model.head.name, param_count)\n        )\n\n        kwds = {\"backbone\": backbone, \"head\": head}\n\n        instance = cls(**kwds)\n        instance.input_shape = input_shape\n\n        param_count = get_human_readable_count(\n            sum([m.numel() for m in instance.parameters()])\n        )\n        _logger.info(\"Model created, param count: {}.\".format(param_count))\n\n        return instance\n\n    def build_param_dicts(self):\n        \"\"\"\n        Builds up the Paramters dicts for optimization\n        \"\"\"\n        backbone_params = self.backbone.build_param_dicts()\n        head_params = self.head.build_param_dicts()\n        parameters = backbone_params + head_params\n\n        # filter and remove any empty paramter groups if any\n        pgs_filterd = []\n\n        for group in parameters:\n            if group[\"params\"] == []:\n                pass\n            else:\n                pgs_filterd += [group]\n        return pgs_filterd\n\n    def get_lrs(self) -> List:\n        \"\"\"\n        Returns a List containining the Lrs' for\n        each parameter group. This is required to build schedulers\n        like `torch.optim.lr_scheduler.OneCycleScheduler` which needs\n        the max lrs' for all the Param Groups.\n        \"\"\"\n        lrs = []\n        for p in self.build_param_dicts():\n            lrs.append(p[\"lr\"])\n        return lrs";
                var nbb_cells = Jupyter.notebook.get_cells();
                for (var i = 0; i < nbb_cells.length; ++i) {
                    if (nbb_cells[i].input_prompt_number == nbb_cell_id) {
                        if (nbb_cells[i].get_text() == nbb_unformatted_code) {
                             nbb_cells[i].set_text(nbb_formatted_code);
                        }
                        break;
                    }
                }
            }, 500);
            
</script>
</div>

</div>

</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>This model architecture will work for most common computer vision fietuning use case. We take a <code>backbone</code> and <code>classifier</code>. We run the input through the backbone to extract the feature_maps which are then used by the classifier to given predictions on the Input. The paramters dicts for optimization are generated by the <code>backbone</code> and the <code>head</code> itself.
{% include note.html content='For advanced use cases you might want to create a model. A model muse inherit from <a href="/gale/core.classes.html#GaleModule"><code>GaleModule</code></a> and be registered in <a href="/gale/core.utils.structures.html#META_ARCH_REGISTRY"><code>META_ARCH_REGISTRY</code></a>. Your model should also have the following methods to work in the Gale ecosystem.' %}</p>

</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="GeneralizedImageClassifier.from_config_dict" class="doc_header"><code>GeneralizedImageClassifier.from_config_dict</code><a href="https://github.com/benihime91/gale/tree/master/gale/classification/modelling/meta_arch/common.py#L58" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>GeneralizedImageClassifier.from_config_dict</code>(<strong><code>cfg</code></strong>:<code>DictConfig</code>)</p>
</blockquote>
<p>Instantiate the Meta Architecture from gale config</p>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="GeneralizedImageClassifier.forward" class="doc_header"><code>GeneralizedImageClassifier.forward</code><a href="https://github.com/benihime91/gale/tree/master/gale/classification/modelling/meta_arch/common.py#L47" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>GeneralizedImageClassifier.forward</code>(<strong><code>batched_inputs</code></strong>:<code>Tensor</code>)</p>
</blockquote>
<p>Runs the batched_inputs through <code>backbone</code> followed by the <code>head</code>.
Returns a Tensor which contains the logits for the batched_inputs.</p>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="GeneralizedImageClassifier.build_param_dicts" class="doc_header"><code>GeneralizedImageClassifier.build_param_dicts</code><a href="https://github.com/benihime91/gale/tree/master/gale/classification/modelling/meta_arch/common.py#L102" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>GeneralizedImageClassifier.build_param_dicts</code>()</p>
</blockquote>
<p>Builds up the Paramters dicts for optimization</p>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p><code>Meta_Arch</code>'s can also be instatiated via a appropriate config file. Let's see how ..</p>

</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="kn">from</span> <span class="nn">dataclasses</span> <span class="kn">import</span> <span class="n">dataclass</span><span class="p">,</span> <span class="n">field</span>
<span class="kn">from</span> <span class="nn">omegaconf</span> <span class="kn">import</span> <span class="n">MISSING</span><span class="p">,</span> <span class="n">OmegaConf</span>
<span class="kn">from</span> <span class="nn">gale.classification.modelling.backbones</span> <span class="kn">import</span> <span class="n">ResNetBackbone</span>
<span class="kn">from</span> <span class="nn">gale.classification.modelling.heads</span> <span class="kn">import</span> <span class="n">FastaiHead</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">




<div id="3a742414-e883-4507-873e-f784a1a0d368"></div>
<div class="output_subarea output_javascript ">
<script type="text/javascript">
var element = $('#3a742414-e883-4507-873e-f784a1a0d368');

            setTimeout(function() {
                var nbb_cell_id = 9;
                var nbb_unformatted_code = "from dataclasses import dataclass, field\nfrom omegaconf import MISSING, OmegaConf\nfrom gale.classification.modelling.backbones import ResNetBackbone\nfrom gale.classification.modelling.heads import FastaiHead";
                var nbb_formatted_code = "from dataclasses import dataclass, field\nfrom omegaconf import MISSING, OmegaConf\nfrom gale.classification.modelling.backbones import ResNetBackbone\nfrom gale.classification.modelling.heads import FastaiHead";
                var nbb_cells = Jupyter.notebook.get_cells();
                for (var i = 0; i < nbb_cells.length; ++i) {
                    if (nbb_cells[i].input_prompt_number == nbb_cell_id) {
                        if (nbb_cells[i].get_text() == nbb_unformatted_code) {
                             nbb_cells[i].set_text(nbb_formatted_code);
                        }
                        break;
                    }
                }
            }, 500);
            
</script>
</div>

</div>

</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>For a meta_arch we first need to create the configurations for the <code>Backbone</code> and the <code>Head</code> of the model. These 
must be registerd in <code>IMAGE_CLASSIFICATION_BACKBONES</code> and <code>IMAGE_CLASSIFICATION_HEADS</code> Registy respectively. The instances are automatically instiated by the <a href="/gale/classification.modelling.meta_arch.common.html#GeneralizedImageClassifier"><code>GeneralizedImageClassifier</code></a> meta_arch.</p>

</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="nd">@dataclass</span>
<span class="k">class</span> <span class="nc">C_Backbone</span><span class="p">:</span>
    <span class="n">model_name</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;resnet18&quot;</span>
    <span class="n">pretrained</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span>
    <span class="n">act</span><span class="p">:</span> <span class="n">Any</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="n">lr</span><span class="p">:</span> <span class="n">Any</span> <span class="o">=</span> <span class="mf">1e-05</span>
    <span class="n">wd</span><span class="p">:</span> <span class="n">Any</span> <span class="o">=</span> <span class="mf">1e-05</span>
    <span class="n">freeze_at</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">4</span>


<span class="nd">@dataclass</span>
<span class="k">class</span> <span class="nc">C_Head</span><span class="p">:</span>
    <span class="n">num_classes</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">2</span>
    <span class="n">drop_rate</span><span class="p">:</span> <span class="n">Any</span> <span class="o">=</span> <span class="mf">0.3</span>
    <span class="n">lr</span><span class="p">:</span> <span class="n">Any</span> <span class="o">=</span> <span class="mf">2e-03</span>
    <span class="n">wd</span><span class="p">:</span> <span class="n">Any</span> <span class="o">=</span> <span class="mf">1e-05</span>
    <span class="n">filter_wd</span><span class="p">:</span> <span class="n">Any</span> <span class="o">=</span> <span class="kc">False</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">




<div id="5cf72b6c-e902-4175-bc2f-b339beec197e"></div>
<div class="output_subarea output_javascript ">
<script type="text/javascript">
var element = $('#5cf72b6c-e902-4175-bc2f-b339beec197e');

            setTimeout(function() {
                var nbb_cell_id = 10;
                var nbb_unformatted_code = "@dataclass\nclass C_Backbone:\n    model_name: str = \"resnet18\"\n    pretrained: bool = True\n    act: Any = None\n    lr: Any = 1e-05\n    wd: Any = 1e-05\n    freeze_at: int = 4\n\n\n@dataclass\nclass C_Head:\n    num_classes: int = 2\n    drop_rate: Any = 0.3\n    lr: Any = 2e-03\n    wd: Any = 1e-05\n    filter_wd: Any = False";
                var nbb_formatted_code = "@dataclass\nclass C_Backbone:\n    model_name: str = \"resnet18\"\n    pretrained: bool = True\n    act: Any = None\n    lr: Any = 1e-05\n    wd: Any = 1e-05\n    freeze_at: int = 4\n\n\n@dataclass\nclass C_Head:\n    num_classes: int = 2\n    drop_rate: Any = 0.3\n    lr: Any = 2e-03\n    wd: Any = 1e-05\n    filter_wd: Any = False";
                var nbb_cells = Jupyter.notebook.get_cells();
                for (var i = 0; i < nbb_cells.length; ++i) {
                    if (nbb_cells[i].input_prompt_number == nbb_cell_id) {
                        if (nbb_cells[i].get_text() == nbb_unformatted_code) {
                             nbb_cells[i].set_text(nbb_formatted_code);
                        }
                        break;
                    }
                }
            }, 500);
            
</script>
</div>

</div>

</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>We also need a few more things and the config must be composed in a gale config style. We need the definitions of the input like channels, height and weight. So let's compose these -</p>

</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">b_args</span> <span class="o">=</span> <span class="n">OmegaConf</span><span class="o">.</span><span class="n">structured</span><span class="p">(</span><span class="n">C_Backbone</span><span class="p">())</span>
<span class="n">h_args</span> <span class="o">=</span> <span class="n">OmegaConf</span><span class="o">.</span><span class="n">structured</span><span class="p">(</span><span class="n">C_Head</span><span class="p">())</span>

<span class="c1"># Backbone config</span>
<span class="n">b</span> <span class="o">=</span> <span class="n">OmegaConf</span><span class="o">.</span><span class="n">create</span><span class="p">()</span>
<span class="n">b</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="s2">&quot;ResNetBackbone&quot;</span>
<span class="n">b</span><span class="o">.</span><span class="n">init_args</span> <span class="o">=</span> <span class="n">b_args</span>

<span class="c1"># Head config</span>
<span class="n">h</span> <span class="o">=</span> <span class="n">OmegaConf</span><span class="o">.</span><span class="n">create</span><span class="p">()</span>
<span class="n">h</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="s2">&quot;FullyConnectedHead&quot;</span>
<span class="n">h</span><span class="o">.</span><span class="n">init_args</span> <span class="o">=</span> <span class="n">h_args</span>

<span class="n">i</span> <span class="o">=</span> <span class="n">OmegaConf</span><span class="o">.</span><span class="n">create</span><span class="p">()</span>
<span class="n">i</span><span class="o">.</span><span class="n">channels</span> <span class="o">=</span> <span class="mi">3</span>
<span class="n">i</span><span class="o">.</span><span class="n">height</span> <span class="o">=</span> <span class="mi">224</span>
<span class="n">i</span><span class="o">.</span><span class="n">width</span> <span class="o">=</span> <span class="mi">224</span>

<span class="n">m</span> <span class="o">=</span> <span class="n">OmegaConf</span><span class="o">.</span><span class="n">create</span><span class="p">()</span>
<span class="n">m</span><span class="o">.</span><span class="n">backbone</span> <span class="o">=</span> <span class="n">b</span>
<span class="n">m</span><span class="o">.</span><span class="n">head</span> <span class="o">=</span> <span class="n">h</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">




<div id="26bd71c0-c171-467c-a178-a4882f71f8a7"></div>
<div class="output_subarea output_javascript ">
<script type="text/javascript">
var element = $('#26bd71c0-c171-467c-a178-a4882f71f8a7');

            setTimeout(function() {
                var nbb_cell_id = 11;
                var nbb_unformatted_code = "b_args = OmegaConf.structured(C_Backbone())\nh_args = OmegaConf.structured(C_Head())\n\n# Backbone config\nb = OmegaConf.create()\nb.name = \"ResNetBackbone\"\nb.init_args = b_args\n\n# Head config\nh = OmegaConf.create()\nh.name = \"FullyConnectedHead\"\nh.init_args = h_args\n\ni = OmegaConf.create()\ni.channels = 3\ni.height = 224\ni.width = 224\n\nm = OmegaConf.create()\nm.backbone = b\nm.head = h";
                var nbb_formatted_code = "b_args = OmegaConf.structured(C_Backbone())\nh_args = OmegaConf.structured(C_Head())\n\n# Backbone config\nb = OmegaConf.create()\nb.name = \"ResNetBackbone\"\nb.init_args = b_args\n\n# Head config\nh = OmegaConf.create()\nh.name = \"FullyConnectedHead\"\nh.init_args = h_args\n\ni = OmegaConf.create()\ni.channels = 3\ni.height = 224\ni.width = 224\n\nm = OmegaConf.create()\nm.backbone = b\nm.head = h";
                var nbb_cells = Jupyter.notebook.get_cells();
                for (var i = 0; i < nbb_cells.length; ++i) {
                    if (nbb_cells[i].input_prompt_number == nbb_cell_id) {
                        if (nbb_cells[i].get_text() == nbb_unformatted_code) {
                             nbb_cells[i].set_text(nbb_formatted_code);
                        }
                        break;
                    }
                }
            }, 500);
            
</script>
</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">conf</span> <span class="o">=</span> <span class="n">OmegaConf</span><span class="o">.</span><span class="n">create</span><span class="p">(</span><span class="nb">dict</span><span class="p">(</span><span class="nb">input</span><span class="o">=</span><span class="n">i</span><span class="p">,</span> <span class="n">model</span><span class="o">=</span><span class="n">m</span><span class="p">))</span>
<span class="c1"># print(OmegaConf.to_yaml(conf))</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">




<div id="21ff3ed5-14a8-4063-8187-05b4ae1b5176"></div>
<div class="output_subarea output_javascript ">
<script type="text/javascript">
var element = $('#21ff3ed5-14a8-4063-8187-05b4ae1b5176');

            setTimeout(function() {
                var nbb_cell_id = 12;
                var nbb_unformatted_code = "conf = OmegaConf.create(dict(input=i, model=m))\n# print(OmegaConf.to_yaml(conf))";
                var nbb_formatted_code = "conf = OmegaConf.create(dict(input=i, model=m))\n# print(OmegaConf.to_yaml(conf))";
                var nbb_cells = Jupyter.notebook.get_cells();
                for (var i = 0; i < nbb_cells.length; ++i) {
                    if (nbb_cells[i].input_prompt_number == nbb_cell_id) {
                        if (nbb_cells[i].get_text() == nbb_unformatted_code) {
                             nbb_cells[i].set_text(nbb_formatted_code);
                        }
                        break;
                    }
                }
            }, 500);
            
</script>
</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">m</span> <span class="o">=</span> <span class="n">GeneralizedImageClassifier</span><span class="o">.</span><span class="n">from_config_dict</span><span class="p">(</span><span class="n">conf</span><span class="p">)</span>
<span class="n">shape</span> <span class="o">=</span> <span class="p">(</span><span class="n">m</span><span class="o">.</span><span class="n">input_shape</span><span class="o">.</span><span class="n">channels</span><span class="p">,</span> <span class="n">m</span><span class="o">.</span><span class="n">input_shape</span><span class="o">.</span><span class="n">height</span><span class="p">,</span> <span class="n">m</span><span class="o">.</span><span class="n">input_shape</span><span class="o">.</span><span class="n">width</span><span class="p">)</span>
<span class="n">inp</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">randn</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="o">*</span><span class="n">shape</span><span class="p">)</span>
<span class="n">o</span> <span class="o">=</span> <span class="n">m</span><span class="p">(</span><span class="n">inp</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">




<div id="c531117f-d7e6-411a-bc8e-0a4250553e28"></div>
<div class="output_subarea output_javascript ">
<script type="text/javascript">
var element = $('#c531117f-d7e6-411a-bc8e-0a4250553e28');

            setTimeout(function() {
                var nbb_cell_id = 13;
                var nbb_unformatted_code = "m = GeneralizedImageClassifier.from_config_dict(conf)\nshape = (m.input_shape.channels, m.input_shape.height, m.input_shape.width)\ninp = torch.randn(2, *shape)\no = m(inp)";
                var nbb_formatted_code = "m = GeneralizedImageClassifier.from_config_dict(conf)\nshape = (m.input_shape.channels, m.input_shape.height, m.input_shape.width)\ninp = torch.randn(2, *shape)\no = m(inp)";
                var nbb_cells = Jupyter.notebook.get_cells();
                for (var i = 0; i < nbb_cells.length; ++i) {
                    if (nbb_cells[i].input_prompt_number == nbb_cell_id) {
                        if (nbb_cells[i].get_text() == nbb_unformatted_code) {
                             nbb_cells[i].set_text(nbb_formatted_code);
                        }
                        break;
                    }
                }
            }, 500);
            
</script>
</div>

</div>

</div>
</div>

</div>
    {% endraw %}

</div>
 

