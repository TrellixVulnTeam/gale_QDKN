---

title: Meta Architectures : Generalized Image Classifier 


keywords: fastai
sidebar: home_sidebar

summary: "Default Model Architecture for Image Classification"
description: "Default Model Architecture for Image Classification"
nb_path: "nbs/04b_classification.model.meta_arch.common.ipynb"
---
<!--

#################################################
### THIS FILE WAS AUTOGENERATED! DO NOT EDIT! ###
#################################################
# file to edit: nbs/04b_classification.model.meta_arch.common.ipynb
# command to build the docs after a change: nbdev_build_docs

-->

<div class="container" id="notebook-container">
        
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h2 id="GeneralizedImageClassifier" class="doc_header"><code>class</code> <code>GeneralizedImageClassifier</code><a href="https://github.com/benihime91/gale/tree/master/gale/classification/model/meta_arch/common.py#L24" class="source_link" style="float:right">[source]</a></h2><blockquote><p><code>GeneralizedImageClassifier</code>(<strong><code>backbone</code></strong>:<a href="/gale/classification.models.backbones.html#ImageClassificationBackbone"><code>ImageClassificationBackbone</code></a>, <strong><code>head</code></strong>:<a href="/gale/classification.models.heads.html#ImageClassificationHead"><code>ImageClassificationHead</code></a>) :: <a href="/gale/core-classes.html#BasicModule"><code>BasicModule</code></a></p>
</blockquote>
<p>A General Image Classifier. Any models that contains the following 2 components:</p>
<ol>
<li>Feature extractor (aka backbone)</li>
<li>Image Classification head (Pooling + Classifier)</li>
</ol>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">




<div id="7e83b209-1e16-4227-a73e-53eff2884209"></div>
<div class="output_subarea output_javascript ">
<script type="text/javascript">
var element = $('#7e83b209-1e16-4227-a73e-53eff2884209');

            setTimeout(function() {
                var nbb_cell_id = 6;
                var nbb_unformatted_code = "# export\nclass GeneralizedImageClassifier(BasicModule):\n    \"\"\"\n    A General Image Classifier. Any models that contains the following 2 components:\n    1. Feature extractor (aka backbone)\n    2. Image Classification head (Pooling + Classifier)\n    \"\"\"\n\n    _hypers = namedtuple(\"hypers\", field_names=[\"lr\", \"wd\"])\n\n    def __init__(\n        self,\n        backbone: ImageClassificationBackbone,\n        head: ImageClassificationHead,\n    ):\n        \"\"\"\n        Arguments:\n        1. `backbone`: a `ImageClassificationBackbone` module, must follow gale's backbone interface\n        2. `head`: a head containg the classifier. and the pooling layer, must be an instance of\n        `ImageClassificationHead`.\n        \"\"\"\n        super(GeneralizedImageClassifier, self).__init__()\n        self.backbone = backbone\n        assert isinstance(backbone, ImageClassificationBackbone)\n        self.head = head\n        assert isinstance(head, ImageClassificationHead)\n\n    def forward(self, batched_inputs: torch.Tensor) -> torch.Tensor:\n        \"\"\"\n        Runs the batched_inputs through `backbone` followed by the `head`.\n        Returns a Tensor which contains the logits for the batched_inputs.\n        \"\"\"\n        # forward pass through the backbone\n        out = self.backbone(batched_inputs)\n        # pass through the classification layer\n        out = self.head(out)\n        return out\n\n    @classmethod\n    def from_config_dict(cls, cfg: DictConfig):\n        \"\"\"\n        Instantiate the Meta Architecture from gale config\n        \"\"\"\n        if not hasattr(cfg.model, \"backbone\"):\n            raise ValueError(\"Configuration for model backbone not found\")\n\n        if not hasattr(cfg.model, \"head\"):\n            raise ValueError(\"Configuration for model head not found\")\n\n        input_shape = ShapeSpec(cfg.input.channels, cfg.input.height, cfg.input.width)\n        _logger.info(f\"Inputs: {input_shape}\")\n\n        backbone = build_backbone(cfg, input_shape=input_shape)\n        param_count = get_human_readable_count(\n            sum([m.numel() for m in backbone.parameters()])\n        )\n        _logger.info(\n            \"Backbone {} created, param count: {}.\".format(\n                cfg.model.backbone.name, param_count\n            )\n        )\n\n        head = build_head(cfg, backbone.output_shape())\n        param_count = get_human_readable_count(\n            sum([m.numel() for m in head.parameters()])\n        )\n        _logger.info(\n            \"Head {} created, param count: {}.\".format(cfg.model.head.name, param_count)\n        )\n\n        kwds = {\"backbone\": backbone, \"head\": head}\n\n        instance = cls(**kwds)\n        instance.input_shape = input_shape\n\n        param_count = get_human_readable_count(\n            sum([m.numel() for m in instance.parameters()])\n        )\n        _logger.info(\"Model created, param count: {}.\".format(param_count))\n\n        return instance\n\n    def build_param_dicts(self):\n        \"\"\"\n        Builds up the Paramters dicts for optimization\n        \"\"\"\n        backbone_params = self.backbone.build_param_dicts()\n        head_params = self.head.build_param_dicts()\n        return backbone_params + head_params\n\n    @property\n    def hypers(self) -> Tuple:\n        \"\"\"\n        Returns list of parameters like `lr` and `wd`\n        for each param group\n        \"\"\"\n        lrs = []\n        wds = []\n\n        for p in self.build_param_dicts():\n            lrs.append(p[\"lr\"])\n            wds.append(p[\"weight_decay\"])\n        return self._hypers(lrs, wds)";
                var nbb_formatted_code = "# export\nclass GeneralizedImageClassifier(BasicModule):\n    \"\"\"\n    A General Image Classifier. Any models that contains the following 2 components:\n    1. Feature extractor (aka backbone)\n    2. Image Classification head (Pooling + Classifier)\n    \"\"\"\n\n    _hypers = namedtuple(\"hypers\", field_names=[\"lr\", \"wd\"])\n\n    def __init__(\n        self,\n        backbone: ImageClassificationBackbone,\n        head: ImageClassificationHead,\n    ):\n        \"\"\"\n        Arguments:\n        1. `backbone`: a `ImageClassificationBackbone` module, must follow gale's backbone interface\n        2. `head`: a head containg the classifier. and the pooling layer, must be an instance of\n        `ImageClassificationHead`.\n        \"\"\"\n        super(GeneralizedImageClassifier, self).__init__()\n        self.backbone = backbone\n        assert isinstance(backbone, ImageClassificationBackbone)\n        self.head = head\n        assert isinstance(head, ImageClassificationHead)\n\n    def forward(self, batched_inputs: torch.Tensor) -> torch.Tensor:\n        \"\"\"\n        Runs the batched_inputs through `backbone` followed by the `head`.\n        Returns a Tensor which contains the logits for the batched_inputs.\n        \"\"\"\n        # forward pass through the backbone\n        out = self.backbone(batched_inputs)\n        # pass through the classification layer\n        out = self.head(out)\n        return out\n\n    @classmethod\n    def from_config_dict(cls, cfg: DictConfig):\n        \"\"\"\n        Instantiate the Meta Architecture from gale config\n        \"\"\"\n        if not hasattr(cfg.model, \"backbone\"):\n            raise ValueError(\"Configuration for model backbone not found\")\n\n        if not hasattr(cfg.model, \"head\"):\n            raise ValueError(\"Configuration for model head not found\")\n\n        input_shape = ShapeSpec(cfg.input.channels, cfg.input.height, cfg.input.width)\n        _logger.info(f\"Inputs: {input_shape}\")\n\n        backbone = build_backbone(cfg, input_shape=input_shape)\n        param_count = get_human_readable_count(\n            sum([m.numel() for m in backbone.parameters()])\n        )\n        _logger.info(\n            \"Backbone {} created, param count: {}.\".format(\n                cfg.model.backbone.name, param_count\n            )\n        )\n\n        head = build_head(cfg, backbone.output_shape())\n        param_count = get_human_readable_count(\n            sum([m.numel() for m in head.parameters()])\n        )\n        _logger.info(\n            \"Head {} created, param count: {}.\".format(cfg.model.head.name, param_count)\n        )\n\n        kwds = {\"backbone\": backbone, \"head\": head}\n\n        instance = cls(**kwds)\n        instance.input_shape = input_shape\n\n        param_count = get_human_readable_count(\n            sum([m.numel() for m in instance.parameters()])\n        )\n        _logger.info(\"Model created, param count: {}.\".format(param_count))\n\n        return instance\n\n    def build_param_dicts(self):\n        \"\"\"\n        Builds up the Paramters dicts for optimization\n        \"\"\"\n        backbone_params = self.backbone.build_param_dicts()\n        head_params = self.head.build_param_dicts()\n        return backbone_params + head_params\n\n    @property\n    def hypers(self) -> Tuple:\n        \"\"\"\n        Returns list of parameters like `lr` and `wd`\n        for each param group\n        \"\"\"\n        lrs = []\n        wds = []\n\n        for p in self.build_param_dicts():\n            lrs.append(p[\"lr\"])\n            wds.append(p[\"weight_decay\"])\n        return self._hypers(lrs, wds)";
                var nbb_cells = Jupyter.notebook.get_cells();
                for (var i = 0; i < nbb_cells.length; ++i) {
                    if (nbb_cells[i].input_prompt_number == nbb_cell_id) {
                        if (nbb_cells[i].get_text() == nbb_unformatted_code) {
                             nbb_cells[i].set_text(nbb_formatted_code);
                        }
                        break;
                    }
                }
            }, 500);
            
</script>
</div>

</div>

</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>This model architecture will work for most common computer vision fietuning use case. We take a <code>backbone</code> and <code>classifier</code>. We run the input through the backbone to extract the feature_maps which are then used by the classifier to given predictions on the Input. The paramters dicts for optimization are generated by the <code>backbone</code> and the <code>head</code> itself.
{% include note.html content='For advanced use cases you might want to create a model. A model muse inherit from <code>GaleModule</code> and be registered in <a href="/gale/utils.structures.html#META_ARCH_REGISTRY"><code>META_ARCH_REGISTRY</code></a>. Your model should also have the following methods to work in the Gale ecosystem.' %}</p>

</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="GeneralizedImageClassifier.from_config_dict" class="doc_header"><code>GeneralizedImageClassifier.from_config_dict</code><a href="https://github.com/benihime91/gale/tree/master/gale/classification/model/meta_arch/common.py#L61" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>GeneralizedImageClassifier.from_config_dict</code>(<strong><code>cfg</code></strong>:<code>DictConfig</code>)</p>
</blockquote>
<p>Instantiate the Meta Architecture from gale config</p>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="GeneralizedImageClassifier.forward" class="doc_header"><code>GeneralizedImageClassifier.forward</code><a href="https://github.com/benihime91/gale/tree/master/gale/classification/model/meta_arch/common.py#L50" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>GeneralizedImageClassifier.forward</code>(<strong><code>batched_inputs</code></strong>:<code>Tensor</code>)</p>
</blockquote>
<p>Runs the batched_inputs through <code>backbone</code> followed by the <code>head</code>.
Returns a Tensor which contains the logits for the batched_inputs.</p>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="GeneralizedImageClassifier.build_param_dicts" class="doc_header"><code>GeneralizedImageClassifier.build_param_dicts</code><a href="https://github.com/benihime91/gale/tree/master/gale/classification/model/meta_arch/common.py#L105" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>GeneralizedImageClassifier.build_param_dicts</code>()</p>
</blockquote>
<p>Builds up the Paramters dicts for optimization</p>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p><code>Meta_Arch</code>'s can also be instatiated via a appropriate config file. Let's see how ..</p>

</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="kn">from</span> <span class="nn">dataclasses</span> <span class="kn">import</span> <span class="n">dataclass</span><span class="p">,</span> <span class="n">field</span>
<span class="kn">from</span> <span class="nn">omegaconf</span> <span class="kn">import</span> <span class="n">MISSING</span><span class="p">,</span> <span class="n">OmegaConf</span>
<span class="kn">from</span> <span class="nn">gale.classification.model.backbones</span> <span class="kn">import</span> <span class="n">ResNetBackbone</span><span class="p">,</span> <span class="n">ResNetBackboneDataClass</span>
<span class="kn">from</span> <span class="nn">gale.classification.model.heads</span> <span class="kn">import</span> <span class="n">FastaiHead</span><span class="p">,</span> <span class="n">FastaiHeadDataClass</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">




<div id="28ae77f4-aac4-4d22-a8bb-d8be69bb2f6c"></div>
<div class="output_subarea output_javascript ">
<script type="text/javascript">
var element = $('#28ae77f4-aac4-4d22-a8bb-d8be69bb2f6c');

            setTimeout(function() {
                var nbb_cell_id = 10;
                var nbb_unformatted_code = "from dataclasses import dataclass, field\nfrom omegaconf import MISSING, OmegaConf\nfrom gale.classification.model.backbones import ResNetBackbone, ResNetBackboneDataClass\nfrom gale.classification.model.heads import FastaiHead, FastaiHeadDataClass";
                var nbb_formatted_code = "from dataclasses import dataclass, field\nfrom omegaconf import MISSING, OmegaConf\nfrom gale.classification.model.backbones import ResNetBackbone, ResNetBackboneDataClass\nfrom gale.classification.model.heads import FastaiHead, FastaiHeadDataClass";
                var nbb_cells = Jupyter.notebook.get_cells();
                for (var i = 0; i < nbb_cells.length; ++i) {
                    if (nbb_cells[i].input_prompt_number == nbb_cell_id) {
                        if (nbb_cells[i].get_text() == nbb_unformatted_code) {
                             nbb_cells[i].set_text(nbb_formatted_code);
                        }
                        break;
                    }
                }
            }, 500);
            
</script>
</div>

</div>

</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>For a meta_arch we first need to create the configurations for the <code>Backbone</code> and the <code>Head</code> of the model. These 
must be registerd in <code>IMAGE_CLASSIFICATION_BACKBONES</code> and <code>IMAGE_CLASSIFICATION_HEADS</code> Registy respectively. The instances are automatically instiated by the <a href="/gale/classification.model.meta_arch.common.html#GeneralizedImageClassifier"><code>GeneralizedImageClassifier</code></a> meta_arch.</p>

</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">backbone</span> <span class="o">=</span> <span class="n">OmegaConf</span><span class="o">.</span><span class="n">create</span><span class="p">()</span>
<span class="n">backbone</span><span class="p">[</span><span class="s2">&quot;name&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;ResNetBackbone&quot;</span>

<span class="n">init_args</span> <span class="o">=</span> <span class="n">ResNetBackboneDataClass</span><span class="p">(</span><span class="n">model_name</span><span class="o">=</span><span class="s2">&quot;resnet18&quot;</span><span class="p">,</span> <span class="n">freeze_at</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
<span class="n">init_args</span> <span class="o">=</span> <span class="n">OmegaConf</span><span class="o">.</span><span class="n">structured</span><span class="p">(</span><span class="n">init_args</span><span class="p">)</span>
<span class="n">backbone</span><span class="p">[</span><span class="s2">&quot;init_args&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">init_args</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">




<div id="12627362-066e-450c-9a04-013cfe1b1c91"></div>
<div class="output_subarea output_javascript ">
<script type="text/javascript">
var element = $('#12627362-066e-450c-9a04-013cfe1b1c91');

            setTimeout(function() {
                var nbb_cell_id = 11;
                var nbb_unformatted_code = "backbone = OmegaConf.create()\nbackbone[\"name\"] = \"ResNetBackbone\"\n\ninit_args = ResNetBackboneDataClass(model_name=\"resnet18\", freeze_at=2)\ninit_args = OmegaConf.structured(init_args)\nbackbone[\"init_args\"] = init_args";
                var nbb_formatted_code = "backbone = OmegaConf.create()\nbackbone[\"name\"] = \"ResNetBackbone\"\n\ninit_args = ResNetBackboneDataClass(model_name=\"resnet18\", freeze_at=2)\ninit_args = OmegaConf.structured(init_args)\nbackbone[\"init_args\"] = init_args";
                var nbb_cells = Jupyter.notebook.get_cells();
                for (var i = 0; i < nbb_cells.length; ++i) {
                    if (nbb_cells[i].input_prompt_number == nbb_cell_id) {
                        if (nbb_cells[i].get_text() == nbb_unformatted_code) {
                             nbb_cells[i].set_text(nbb_formatted_code);
                        }
                        break;
                    }
                }
            }, 500);
            
</script>
</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">head</span> <span class="o">=</span> <span class="n">OmegaConf</span><span class="o">.</span><span class="n">create</span><span class="p">()</span>
<span class="n">head</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="s2">&quot;FastaiHead&quot;</span>
<span class="n">head</span><span class="o">.</span><span class="n">init_args</span> <span class="o">=</span> <span class="n">OmegaConf</span><span class="o">.</span><span class="n">structured</span><span class="p">(</span><span class="n">FastaiHeadDataClass</span><span class="p">(</span><span class="n">num_classes</span><span class="o">=</span><span class="mi">2</span><span class="p">))</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">




<div id="d194a0a9-960d-4e91-b44b-f20919e013d9"></div>
<div class="output_subarea output_javascript ">
<script type="text/javascript">
var element = $('#d194a0a9-960d-4e91-b44b-f20919e013d9');

            setTimeout(function() {
                var nbb_cell_id = 12;
                var nbb_unformatted_code = "head = OmegaConf.create()\nhead.name = \"FastaiHead\"\nhead.init_args = OmegaConf.structured(FastaiHeadDataClass(num_classes=2))";
                var nbb_formatted_code = "head = OmegaConf.create()\nhead.name = \"FastaiHead\"\nhead.init_args = OmegaConf.structured(FastaiHeadDataClass(num_classes=2))";
                var nbb_cells = Jupyter.notebook.get_cells();
                for (var i = 0; i < nbb_cells.length; ++i) {
                    if (nbb_cells[i].input_prompt_number == nbb_cell_id) {
                        if (nbb_cells[i].get_text() == nbb_unformatted_code) {
                             nbb_cells[i].set_text(nbb_formatted_code);
                        }
                        break;
                    }
                }
            }, 500);
            
</script>
</div>

</div>

</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>We also need a few more things and the config must be composed in a gale config style. We need the definitions of the input like channels, height and width. So let's compose these -</p>

</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">INPUTS</span> <span class="o">=</span> <span class="n">OmegaConf</span><span class="o">.</span><span class="n">create</span><span class="p">()</span>
<span class="n">INPUTS</span><span class="o">.</span><span class="n">channels</span> <span class="o">=</span> <span class="mi">3</span>
<span class="n">INPUTS</span><span class="o">.</span><span class="n">height</span> <span class="o">=</span> <span class="mi">224</span>
<span class="n">INPUTS</span><span class="o">.</span><span class="n">width</span> <span class="o">=</span> <span class="mi">224</span>

<span class="c1"># Configuration for Model</span>
<span class="n">MODEL</span> <span class="o">=</span> <span class="n">OmegaConf</span><span class="o">.</span><span class="n">create</span><span class="p">()</span>
<span class="n">MODEL</span><span class="o">.</span><span class="n">meta_architecture</span> <span class="o">=</span> <span class="n">OmegaConf</span><span class="o">.</span><span class="n">create</span><span class="p">()</span>
<span class="n">MODEL</span><span class="o">.</span><span class="n">meta_architecture</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="s2">&quot;GeneralizedImageClassifier&quot;</span>
<span class="n">MODEL</span><span class="o">.</span><span class="n">meta_architecture</span><span class="o">.</span><span class="n">init_args</span> <span class="o">=</span> <span class="kc">None</span>
<span class="n">MODEL</span><span class="o">.</span><span class="n">backbone</span> <span class="o">=</span> <span class="n">backbone</span>
<span class="n">MODEL</span><span class="o">.</span><span class="n">head</span> <span class="o">=</span> <span class="n">head</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">




<div id="2f70bc51-00e3-4220-b8c8-9071fd09bf72"></div>
<div class="output_subarea output_javascript ">
<script type="text/javascript">
var element = $('#2f70bc51-00e3-4220-b8c8-9071fd09bf72');

            setTimeout(function() {
                var nbb_cell_id = 13;
                var nbb_unformatted_code = "# Input config\nINPUTS = OmegaConf.create()\nINPUTS.channels = 3\nINPUTS.height = 224\nINPUTS.width = 224\n\n# Configuration for Model\nMODEL = OmegaConf.create()\nMODEL.meta_architecture = OmegaConf.create()\nMODEL.meta_architecture.name = \"GeneralizedImageClassifier\"\nMODEL.meta_architecture.init_args = None\nMODEL.backbone = backbone\nMODEL.head = head";
                var nbb_formatted_code = "# Input config\nINPUTS = OmegaConf.create()\nINPUTS.channels = 3\nINPUTS.height = 224\nINPUTS.width = 224\n\n# Configuration for Model\nMODEL = OmegaConf.create()\nMODEL.meta_architecture = OmegaConf.create()\nMODEL.meta_architecture.name = \"GeneralizedImageClassifier\"\nMODEL.meta_architecture.init_args = None\nMODEL.backbone = backbone\nMODEL.head = head";
                var nbb_cells = Jupyter.notebook.get_cells();
                for (var i = 0; i < nbb_cells.length; ++i) {
                    if (nbb_cells[i].input_prompt_number == nbb_cell_id) {
                        if (nbb_cells[i].get_text() == nbb_unformatted_code) {
                             nbb_cells[i].set_text(nbb_formatted_code);
                        }
                        break;
                    }
                }
            }, 500);
            
</script>
</div>

</div>

</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>So, these are the bare minimums that one would need to instantiate <a href="/gale/classification.model.meta_arch.common.html#GeneralizedImageClassifier"><code>GeneralizedImageClassifier</code></a></p>

</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">conf</span> <span class="o">=</span> <span class="n">OmegaConf</span><span class="o">.</span><span class="n">create</span><span class="p">(</span><span class="nb">dict</span><span class="p">(</span><span class="nb">input</span><span class="o">=</span><span class="n">INPUTS</span><span class="p">,</span> <span class="n">model</span><span class="o">=</span><span class="n">MODEL</span><span class="p">))</span>
<span class="nb">print</span><span class="p">(</span><span class="n">OmegaConf</span><span class="o">.</span><span class="n">to_yaml</span><span class="p">(</span><span class="n">conf</span><span class="p">))</span>
</pre></div>

    </div>
</div>
</div>
<details class="description">
      <summary data-open="Hide Output" data-close="Show Output"></summary>
        <summary></summary>
        
<div class="output_wrapper">
<div class="output">

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>input:
  channels: 3
  height: 224
  width: 224
model:
  meta_architecture:
    name: GeneralizedImageClassifier
    init_args: null
  backbone:
    name: ResNetBackbone
    init_args:
      model_name: resnet18
      act: null
      lr: 0.001
      lr_div: 10
      wd: 0.0
      freeze_at: 2
      pretrained: true
      drop_block_rate: null
      drop_path_rate: null
      bn_tf: false
  head:
    name: FastaiHead
    init_args:
      num_classes: 2
      act: ReLU
      lin_ftrs: null
      ps: 0.5
      concat_pool: true
      first_bn: true
      bn_final: false
      lr: 0.002
      wd: 0.0
      filter_wd: false

</pre>
</div>
</div>

<div class="output_area">




<div id="8526bfe2-aca2-4ceb-9710-3c1fd91b692c"></div>
<div class="output_subarea output_javascript ">
<script type="text/javascript">
var element = $('#8526bfe2-aca2-4ceb-9710-3c1fd91b692c');

            setTimeout(function() {
                var nbb_cell_id = 14;
                var nbb_unformatted_code = "# collapse-output\nconf = OmegaConf.create(dict(input=INPUTS, model=MODEL))\nprint(OmegaConf.to_yaml(conf))";
                var nbb_formatted_code = "# collapse-output\nconf = OmegaConf.create(dict(input=INPUTS, model=MODEL))\nprint(OmegaConf.to_yaml(conf))";
                var nbb_cells = Jupyter.notebook.get_cells();
                for (var i = 0; i < nbb_cells.length; ++i) {
                    if (nbb_cells[i].input_prompt_number == nbb_cell_id) {
                        if (nbb_cells[i].get_text() == nbb_unformatted_code) {
                             nbb_cells[i].set_text(nbb_formatted_code);
                        }
                        break;
                    }
                }
            }, 500);
            
</script>
</div>

</div>

</div>
</div>

    </details>
</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">m</span> <span class="o">=</span> <span class="n">GeneralizedImageClassifier</span><span class="o">.</span><span class="n">from_config_dict</span><span class="p">(</span><span class="n">conf</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">

<div class="output_subarea output_stream output_stderr output_text">
<pre>Inputs: ShapeSpec(channels=3, height=224, width=224)
Loading pretrained weights from url (https://download.pytorch.org/models/resnet18-5c106cde.pth)
Backbone ResNetBackbone created, param count: 11.2 M.
Head FastaiHead created, param count: 528 K.
Model created, param count: 11.7 M.
</pre>
</div>
</div>

<div class="output_area">




<div id="e8188cfc-0d8d-44b9-8365-1208f838ba08"></div>
<div class="output_subarea output_javascript ">
<script type="text/javascript">
var element = $('#e8188cfc-0d8d-44b9-8365-1208f838ba08');

            setTimeout(function() {
                var nbb_cell_id = 16;
                var nbb_unformatted_code = "m = GeneralizedImageClassifier.from_config_dict(conf)";
                var nbb_formatted_code = "m = GeneralizedImageClassifier.from_config_dict(conf)";
                var nbb_cells = Jupyter.notebook.get_cells();
                for (var i = 0; i < nbb_cells.length; ++i) {
                    if (nbb_cells[i].input_prompt_number == nbb_cell_id) {
                        if (nbb_cells[i].get_text() == nbb_unformatted_code) {
                             nbb_cells[i].set_text(nbb_formatted_code);
                        }
                        break;
                    }
                }
            }, 500);
            
</script>
</div>

</div>

</div>
</div>

</div>
    {% endraw %}

</div>
 

